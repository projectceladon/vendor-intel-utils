From 7f16acd4d2278002b009b64733dea4575ed77204 Mon Sep 17 00:00:00 2001
From: Wenkui <kui.wen@intel.com>
Date: Mon, 8 Jan 2024 05:43:54 +0000
Subject: [PATCH] Debug guc abnormal issue

Signed-off-by: Wenkui <kui.wen@intel.com>
---
 drivers/gpu/drm/i915/gt/uc/intel_guc.c | 2 +-
 drivers/gpu/drm/i915/i915_gem.h        | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/i915/gt/uc/intel_guc.c b/drivers/gpu/drm/i915/gt/uc/intel_guc.c
index 6df1ee351a42..0e1fd18d9dcb 100644
--- a/drivers/gpu/drm/i915/gt/uc/intel_guc.c
+++ b/drivers/gpu/drm/i915/gt/uc/intel_guc.c
@@ -1003,7 +1003,7 @@ static int guc_send_invalidate_tlb(struct intel_guc *guc, u32 *action, u32 size)
  * timeout and max number of outstanding invalidation requests that can be
  * queued in CT buffer.
  */
-#define OUTSTANDING_GUC_TIMEOUT_PERIOD  (HZ)
+#define OUTSTANDING_GUC_TIMEOUT_PERIOD  (HZ) * 10
 	if (!must_wait_woken(&wait, OUTSTANDING_GUC_TIMEOUT_PERIOD)) {
 		/*
 		 * XXX: Failure of tlb invalidation is critical and would
diff --git a/drivers/gpu/drm/i915/i915_gem.h b/drivers/gpu/drm/i915/i915_gem.h
index a5cdf6662d01..ef7552ba0223 100644
--- a/drivers/gpu/drm/i915/i915_gem.h
+++ b/drivers/gpu/drm/i915/i915_gem.h
@@ -108,7 +108,7 @@ int i915_gem_open(struct drm_i915_private *i915, struct drm_file *file);
 #define GEM_DEBUG_WARN_ON(expr) ({ BUILD_BUG_ON_INVALID(expr); 0; })
 #endif
 
-#if IS_ENABLED(CONFIG_DRM_I915_TRACE_GEM)
+#ifndef CONFIG_DRM_I915_TRACE_GEM
 #define GEM_TRACE(...) trace_printk(__VA_ARGS__)
 #define GEM_TRACE_ERR(...) do {						\
 	pr_err(__VA_ARGS__);						\
-- 
2.34.1

