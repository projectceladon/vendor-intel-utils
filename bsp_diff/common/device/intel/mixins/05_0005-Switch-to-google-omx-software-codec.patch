From 2211cef9f101494d65d80d8c8aa4f37d040a85e0 Mon Sep 17 00:00:00 2001
From: renchenglei <chenglei.ren@intel.com>
Date: Wed, 17 Mar 2021 20:16:05 +0800
Subject: [PATCH 1/2] Switch to google omx software codec

Tracked-On:
---
 groups/codecs/configurable/media_codecs.xml     | 1 +
 groups/codecs/configurable/media_codecs_vp9.xml | 1 +
 groups/codecs/configurable/product.mk           | 1 +
 groups/device-specific/caas/init.rc             | 3 +++
 4 files changed, 6 insertions(+)

diff --git a/groups/codecs/configurable/media_codecs.xml b/groups/codecs/configurable/media_codecs.xml
index e1656709f44e..c9aaf2dc1c44 100644
--- a/groups/codecs/configurable/media_codecs.xml
+++ b/groups/codecs/configurable/media_codecs.xml
@@ -211,6 +211,7 @@ Only the three quirks included above are recognized at this point:
         </MediaCodec>
 {{/hw_ve_h265}}
     </Encoders>
+    <Include href="media_codecs_google_video.xml" />
     <Include href="media_codecs_google_audio.xml" />
     <Settings>
         <Setting name="max-video-encoder-input-buffers" value="9" />
diff --git a/groups/codecs/configurable/media_codecs_vp9.xml b/groups/codecs/configurable/media_codecs_vp9.xml
index 8b5e7480a31a..096308bb38c2 100644
--- a/groups/codecs/configurable/media_codecs_vp9.xml
+++ b/groups/codecs/configurable/media_codecs_vp9.xml
@@ -210,6 +210,7 @@ Only the three quirks included above are recognized at this point:
         </MediaCodec>
 {{/hw_ve_h265}}
     </Encoders>
+    <Include href="media_codecs_google_video.xml" />
     <Include href="media_codecs_google_audio.xml" />
     <Settings>
         <Setting name="max-video-encoder-input-buffers" value="9" />
diff --git a/groups/codecs/configurable/product.mk b/groups/codecs/configurable/product.mk
index f88a32ec5cfd..be2cf5222f54 100644
--- a/groups/codecs/configurable/product.mk
+++ b/groups/codecs/configurable/product.mk
@@ -1,6 +1,7 @@
 # Audio/video codec support.
 PRODUCT_COPY_FILES += \
     frameworks/av/media/libstagefright/data/media_codecs_google_audio.xml:vendor/etc/media_codecs_google_audio.xml \
+    frameworks/av/media/libstagefright/data/media_codecs_google_video.xml:vendor/etc/media_codecs_google_video.xml \
     $(LOCAL_PATH)/{{_extra_dir}}/{{profile_file}}:vendor/etc/media_profiles_V1_0.xml
 
 ifeq ($(BASE_YOCTO_KERNEL),true)
diff --git a/groups/device-specific/caas/init.rc b/groups/device-specific/caas/init.rc
index ea10bd9e0a11..9f94e8578f9d 100644
--- a/groups/device-specific/caas/init.rc
+++ b/groups/device-specific/caas/init.rc
@@ -41,3 +41,6 @@ on post-fs
     insmod /vendor/lib/modules/asix.ko
     insmod /vendor/lib/modules/r8152.ko
     insmod /vendor/lib/modules/r8169.ko
+
+on post-fs-data
+    setprop debug.stagefright.ccodec 0
-- 
2.17.1

