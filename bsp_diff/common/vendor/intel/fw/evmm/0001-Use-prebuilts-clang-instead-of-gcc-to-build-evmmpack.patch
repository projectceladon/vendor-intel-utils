From 09a06726a6d710c4411ffe5b7e9c448a0379379c Mon Sep 17 00:00:00 2001
From: yaravapa <yasoda.aravapalli@intel.com>
Date: Mon, 25 Jan 2021 10:30:47 +0530
Subject: [PATCH] Use prebuilts clang instead of gcc to build evmmpacker

This is required to enable setup path for
Android 11

Tracked-On: OAM-95316
Signed-off-by: yaravapa <yasoda.aravapalli@intel.com>
---
 include/vmm_base.h | 4 ++++
 packer/Makefile    | 3 ++-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/include/vmm_base.h b/include/vmm_base.h
index 7c86c04..fcf311f 100644
--- a/include/vmm_base.h
+++ b/include/vmm_base.h
@@ -37,7 +37,11 @@ typedef struct {
 #define FALSE 0
 #define TRUE 1
 
+// NULL is defined in prebuilts clang stl header
+// so redefining here within a include guard 
+#ifndef NULL
 #define NULL ((void *)0)
+#endif
 
 #define ALIGN_B(value, align) \
 	((uint64_t)(value) & (~((uint64_t)(align) - 1ULL)))
diff --git a/packer/Makefile b/packer/Makefile
index 3d5c88d..5392f55 100644
--- a/packer/Makefile
+++ b/packer/Makefile
@@ -7,7 +7,7 @@
 ################################################
 
 #using local gcc for evmmpacker
-export CC = gcc
+export CC = clang
 
 OUTDIR = $(BUILD_DIR)packer/
 $(shell mkdir -p $(OUTDIR))
@@ -35,6 +35,7 @@ CFLAGS = $(EVMM_CMPL_FLAGS) -s -static -Werror
 endif
 
 CFLAGS += $(INCLUDES)
+CFLAGS += -Qunused-arguments
 
 COBJS = $(addprefix $(OUTDIR), $(notdir $(patsubst %.c, %.o, $(CSOURCES))))
 
-- 
2.17.1

