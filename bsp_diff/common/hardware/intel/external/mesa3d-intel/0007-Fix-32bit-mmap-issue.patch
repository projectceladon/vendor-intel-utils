From 47243f41c8840ae41f32131170da780214e34d21 Mon Sep 17 00:00:00 2001
From: Marc Mao <xmao4@intel.com>
Date: Sun, 28 Mar 2021 21:27:31 +0800
Subject: [PATCH] Fix 32bit mmap issue in opengles

Signed-off-by: Marc Mao <xmao4@intel.com>
Change-Id: I4e6b30472430a30b73dd008b7eae39368eb9e52d
Signed-off-by: Marc Mao <marc.mao@intel.com>
---
 src/gallium/drivers/iris/iris_bufmgr.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/gallium/drivers/iris/iris_bufmgr.c b/src/gallium/drivers/iris/iris_bufmgr.c
old mode 100644
new mode 100755
index 16b9ffb365b..966c79de33e
--- a/src/gallium/drivers/iris/iris_bufmgr.c
+++ b/src/gallium/drivers/iris/iris_bufmgr.c
@@ -1636,8 +1636,13 @@ iris_bo_gem_mmap_offset(struct util_debug_callback *dbg, struct iris_bo *bo)
    }
 
    /* And map it */
+#ifdef __x86_64__
    void *map = mmap(0, bo->size, PROT_READ | PROT_WRITE, MAP_SHARED,
                     bufmgr->fd, mmap_arg.offset);
+#else
+   void *map = mmap64(0, bo->size, PROT_READ | PROT_WRITE, MAP_SHARED,
+				 bufmgr->fd, mmap_arg.offset);
+#endif
    if (map == MAP_FAILED) {
       DBG("%s:%d: Error mapping buffer %d (%s): %s .\n",
           __FILE__, __LINE__, bo->gem_handle, bo->name, strerror(errno));
-- 
2.40.0

