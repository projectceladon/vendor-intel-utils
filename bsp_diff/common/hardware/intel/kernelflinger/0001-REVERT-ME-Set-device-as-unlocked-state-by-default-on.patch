From bc3be663972a2e5b7ebc6a7e4a83a1e8fc68a427 Mon Sep 17 00:00:00 2001
From: "Huang, Yang" <yang.huang@intel.com>
Date: Wed, 6 Dec 2023 03:32:00 +0800
Subject: [PATCH] [REVERT ME]: Set device as unlocked state by default on 
 userdebug

This is only WA patch to set device as unlocked.
The patch should be removed if fastboot is supported
for BM.

With this patch, device will be unlocked on userdebug build;
For user build, it still locked.

Tracked-On: OAM-108853
Signed-off-by: Chen, Gang G <gang.g.chen@intel.com>
Author: Chen, Gang G <gang.g.chen@intel.com>
---
 kernelflinger.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/kernelflinger.c b/kernelflinger.c
index cc7739b..853319b 100644
--- a/kernelflinger.c
+++ b/kernelflinger.c
@@ -1270,11 +1270,17 @@ EFI_STATUS efi_main(EFI_HANDLE image, EFI_SYSTEM_TABLE *sys_table)
 
 	need_lock = device_need_locked();
 
+#ifndef USER
+	/* WA patch to set device as unlocked by default for userdebug build
+	 */
+	set_current_state(UNLOCKED);
+#else
 	/* For civ, flash images to disk is not MUST. So set device to LOCKED
 	 * state by default on the first boot.
 	*/
 	if (need_lock)
 		set_current_state(LOCKED);
+#endif
 
 	ret = set_device_security_info(NULL);
 	if (EFI_ERROR(ret)) {
-- 
2.25.1

