From 2610d6912ae805543d4b3120f290945bd9e484b5 Mon Sep 17 00:00:00 2001
From: Jeevaka Prabu Badrappan <jeevaka.badrappan@intel.com>
Date: Thu, 16 Sep 2021 23:08:18 +0530
Subject: [PATCH] Revert "ANDROID: usb: host: Use old init scheme when hook
 unavailable"

This reverts commit 01a0d1ea31c485ff434aa8d1cbcbfc89f724fff9.

Signed-off-by: Jeevaka Prabu Badrappan <jeevaka.badrappan@intel.com>
---
 drivers/usb/host/xhci-mem.c | 9 ++-------
 1 file changed, 2 insertions(+), 7 deletions(-)

diff --git a/drivers/usb/host/xhci-mem.c b/drivers/usb/host/xhci-mem.c
index 52d80b2c6f0e..aa2dfc0d0884 100644
--- a/drivers/usb/host/xhci-mem.c
+++ b/drivers/usb/host/xhci-mem.c
@@ -528,7 +528,6 @@ struct xhci_container_ctx *xhci_alloc_container_ctx(struct xhci_hcd *xhci,
 {
 	struct xhci_container_ctx *ctx;
 	struct device *dev = xhci_to_hcd(xhci)->self.sysdev;
-	struct xhci_vendor_ops *ops = xhci_vendor_get_ops(xhci);
 
 	if ((type != XHCI_CTX_TYPE_DEVICE) && (type != XHCI_CTX_TYPE_INPUT))
 		return NULL;
@@ -542,8 +541,7 @@ struct xhci_container_ctx *xhci_alloc_container_ctx(struct xhci_hcd *xhci,
 	if (type == XHCI_CTX_TYPE_INPUT)
 		ctx->size += CTX_SIZE(xhci->hcc_params);
 
-	if (xhci_vendor_is_usb_offload_enabled(xhci, NULL, 0) &&
-	    (ops && ops->alloc_container_ctx))
+	if (xhci_vendor_is_usb_offload_enabled(xhci, NULL, 0))
 		xhci_vendor_alloc_container_ctx(xhci, ctx, type, flags);
 	else
 		ctx->bytes = dma_pool_zalloc(xhci->device_pool, flags, &ctx->dma);
@@ -558,12 +556,9 @@ struct xhci_container_ctx *xhci_alloc_container_ctx(struct xhci_hcd *xhci,
 void xhci_free_container_ctx(struct xhci_hcd *xhci,
 			     struct xhci_container_ctx *ctx)
 {
-	struct xhci_vendor_ops *ops = xhci_vendor_get_ops(xhci);
-
 	if (!ctx)
 		return;
-	if (xhci_vendor_is_usb_offload_enabled(xhci, NULL, 0) &&
-	    (ops && ops->free_container_ctx))
+	if (xhci_vendor_is_usb_offload_enabled(xhci, NULL, 0))
 		xhci_vendor_free_container_ctx(xhci, ctx);
 	else
 		dma_pool_free(xhci->device_pool, ctx->bytes, ctx->dma);
-- 
2.33.0

