From dcdaef7b22e0a88f625b16e5b04ccca5626755d3 Mon Sep 17 00:00:00 2001
From: jizhenlo <zhenlong.z.ji@intel.com>
Date: Fri, 22 Jul 2022 16:33:13 +0800
Subject: [PATCH] Disable the ratelimit for print

Signed-off-by: jizhenlo <zhenlong.z.ji@intel.com>
---
 include/linux/ratelimit_types.h |  4 ++--
 kernel/audit.c                  | 21 +++++++++------------
 2 files changed, 11 insertions(+), 14 deletions(-)

diff --git a/include/linux/ratelimit_types.h b/include/linux/ratelimit_types.h
index b676aa419eef..fe576802bb3a 100644
--- a/include/linux/ratelimit_types.h
+++ b/include/linux/ratelimit_types.h
@@ -6,8 +6,8 @@
 #include <linux/param.h>
 #include <linux/spinlock_types.h>
 
-#define DEFAULT_RATELIMIT_INTERVAL	(5 * HZ)
-#define DEFAULT_RATELIMIT_BURST		10
+#define DEFAULT_RATELIMIT_INTERVAL	(0 * HZ)
+#define DEFAULT_RATELIMIT_BURST		1000000
 
 /* issue num suppressed message on exit */
 #define RATELIMIT_MSG_ON_RELEASE	BIT(0)
diff --git a/kernel/audit.c b/kernel/audit.c
index 3db7741f7dd1..550567a64e1a 100644
--- a/kernel/audit.c
+++ b/kernel/audit.c
@@ -2418,20 +2418,17 @@ void audit_log_end(struct audit_buffer *ab)
 	if (!ab)
 		return;
 
-	if (audit_rate_check()) {
-		skb = ab->skb;
-		ab->skb = NULL;
+	skb = ab->skb;
+	ab->skb = NULL;
 
-		/* setup the netlink header, see the comments in
-		 * kauditd_send_multicast_skb() for length quirks */
-		nlh = nlmsg_hdr(skb);
-		nlh->nlmsg_len = skb->len - NLMSG_HDRLEN;
+	/* setup the netlink header, see the comments in
+	 * kauditd_send_multicast_skb() for length quirks */
+	nlh = nlmsg_hdr(skb);
+	nlh->nlmsg_len = skb->len - NLMSG_HDRLEN;
 
-		/* queue the netlink packet and poke the kauditd thread */
-		skb_queue_tail(&audit_queue, skb);
-		wake_up_interruptible(&kauditd_wait);
-	} else
-		audit_log_lost("rate limit exceeded");
+	/* queue the netlink packet and poke the kauditd thread */
+	skb_queue_tail(&audit_queue, skb);
+	wake_up_interruptible(&kauditd_wait);
 
 	audit_buffer_free(ab);
 }
-- 
2.25.1

