From 7a0e8cc01b424a6fcf3b3c0cd8bbc8371676da2f Mon Sep 17 00:00:00 2001
From: Marc Mao <marc.mao@intel.com>
Date: Wed, 29 Mar 2023 13:53:59 +0800
Subject: [FEATURE] Enable xmlconfig for Android

Change-Id: Ic87bd8fea01147fdea024714d635dc1da6d67fd9
Signed-off-by: Marc Mao <marc.mao@intel.com>
---
 meson.build          | 2 +-
 src/util/xmlconfig.c | 7 +++++++
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/meson.build b/meson.build
index 5aeee2de24d..feff83cccd8 100644
--- a/meson.build
+++ b/meson.build
@@ -1486,7 +1486,7 @@ endif
 
 # We don't have expat on Android or Windows, which is a needed dep for xmlconfig
 opt_xmlconfig = get_option('xmlconfig') \
-  .require(not (with_platform_android or with_platform_windows),
+  .require(not (with_platform_windows),
            error_message : 'xmlconfig not available on Android or Windows')
 
 if host_machine.system() == 'darwin'
diff --git a/src/util/xmlconfig.c b/src/util/xmlconfig.c
index 62b163be25e..9762235b02b 100644
--- a/src/util/xmlconfig.c
+++ b/src/util/xmlconfig.c
@@ -1165,9 +1165,16 @@ initOptionCache(driOptionCache *cache, const driOptionCache *info)
    }
 }
 
+#if defined(ANDROID)
+#if defined (SYSCONFDIR)
+#undef SYSCONFDIR
+#endif
+#define SYSCONFDIR "/vendor/etc"
+#else
 #ifndef SYSCONFDIR
 #define SYSCONFDIR "/etc"
 #endif
+#endif
 
 #ifndef DATADIR
 #define DATADIR "/usr/share"
-- 
2.25.1

