From 0c51c0ed7728b371f225cc4471ec939136600184 Mon Sep 17 00:00:00 2001
From: Marc Mao <marc.mao@intel.com>
Date: Thu, 1 Dec 2022 10:49:25 +0800
Subject: [FEATURE] Enable xmlconfig for Android

Change-Id: Ib03cc4b8a80e47cfe1fdfbea78fc1cd1471f031c
Signed-off-by: Marc Mao <marc.mao@intel.com>
---
 meson.build          | 2 +-
 src/util/xmlconfig.c | 7 +++++++
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/meson.build b/meson.build
index 4f3f8cfa41c..6a2e6ad8c0b 100644
--- a/meson.build
+++ b/meson.build
@@ -1635,7 +1635,7 @@ if dep_thread.found()
 endif
 
 # We don't have expat on Android or Windows, which is a needed dep for xmlconfig
-supports_xmlconfig = not (with_platform_android or with_platform_windows)
+supports_xmlconfig = not (with_platform_windows)
 
 opt_xmlconfig = get_option('xmlconfig')
 if opt_xmlconfig.enabled() and not supports_xmlconfig
diff --git a/src/util/xmlconfig.c b/src/util/xmlconfig.c
index 855b869d8b1..8e2827388b0 100644
--- a/src/util/xmlconfig.c
+++ b/src/util/xmlconfig.c
@@ -1163,9 +1163,16 @@ initOptionCache(driOptionCache *cache, const driOptionCache *info)
    }
 }
 
+#if defined(ANDROID)
+#if defined (SYSCONFDIR)
+#undef SYSCONFDIR
+#endif
+#define SYSCONFDIR "/vendor/etc"
+#else
 #ifndef SYSCONFDIR
 #define SYSCONFDIR "/etc"
 #endif
+#endif
 
 #ifndef DATADIR
 #define DATADIR "/usr/share"
-- 
2.33.1

