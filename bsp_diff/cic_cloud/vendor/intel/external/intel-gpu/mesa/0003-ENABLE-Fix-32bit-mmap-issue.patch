From 9da36c2662c2703dbd23d364b6e2e8947e01acda Mon Sep 17 00:00:00 2001
From: Huang Rui <rui1.huang@intel.com>
Date: Mon, 3 Apr 2023 22:04:36 +0800
Subject: [ENABLE] Fix 32bit mmap issue

Signed-off-by: Marc Mao <marc.mao@intel.com>
---
 src/gallium/drivers/iris/i915/iris_kmd_backend.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/gallium/drivers/iris/i915/iris_kmd_backend.c b/src/gallium/drivers/iris/i915/iris_kmd_backend.c
index 2d71611322f..bd6b0c83cdb 100644
--- a/src/gallium/drivers/iris/i915/iris_kmd_backend.c
+++ b/src/gallium/drivers/iris/i915/iris_kmd_backend.c
@@ -204,8 +204,14 @@ i915_gem_mmap_offset(struct iris_bufmgr *bufmgr, struct iris_bo *bo)
    }
 
    /* And map it */
+#ifdef __x86_64__
    void *map = mmap(0, bo->size, PROT_READ | PROT_WRITE, MAP_SHARED,
                     iris_bufmgr_get_fd(bufmgr), mmap_arg.offset);
+#else
+   void *map = mmap64(0, bo->size, PROT_READ | PROT_WRITE, MAP_SHARED,
+                    iris_bufmgr_get_fd(bufmgr), mmap_arg.offset);
+#endif
+
    if (map == MAP_FAILED) {
       DBG("%s:%d: Error mapping buffer %d (%s): %s .\n",
           __FILE__, __LINE__, bo->gem_handle, bo->name, strerror(errno));
-- 
2.25.1

