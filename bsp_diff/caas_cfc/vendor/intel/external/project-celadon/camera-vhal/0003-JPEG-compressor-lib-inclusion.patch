From 656493d0162261289bdbeafb26b409ef6556d0f8 Mon Sep 17 00:00:00 2001
From: gkdeepa <g.k.deepa@intel.com>
Date: Tue, 2 Nov 2021 13:54:55 +0530
Subject: [PATCH] JPEG compressor lib inclusion

Tracked-On:
---
 src/NV21JpegCompressor.cpp   | 2 +-
 src/jpeg-stub/Compressor.cpp | 2 +-
 src/jpeg-stub/JpegStub.cpp   | 5 ++---
 3 files changed, 4 insertions(+), 5 deletions(-)

diff --git a/src/NV21JpegCompressor.cpp b/src/NV21JpegCompressor.cpp
index 3348959..a320886 100644
--- a/src/NV21JpegCompressor.cpp
+++ b/src/NV21JpegCompressor.cpp
@@ -45,7 +45,7 @@ typedef void (*GetCompressedImageFunc)(JpegStub *stub, void *buff);
 typedef size_t (*GetCompressedSizeFunc)(JpegStub *stub);
 
 NV21JpegCompressor::NV21JpegCompressor() {
-    const char dlName[] = "/system/vendor/lib64/hw/camera.cic_cloud.jpeg.so";
+    const char dlName[] = "/system/vendor/lib64/hw/camera.celadon.jpeg.so";
     if (!mDl) {
         mDl = dlopen(dlName, RTLD_NOW);
     }
diff --git a/src/jpeg-stub/Compressor.cpp b/src/jpeg-stub/Compressor.cpp
index 385937c..4d67ac3 100644
--- a/src/jpeg-stub/Compressor.cpp
+++ b/src/jpeg-stub/Compressor.cpp
@@ -16,7 +16,7 @@
 
 #include "Compressor.h"
 
-// #define LOG_NDEBUG 0
+#define LOG_NDEBUG 0
 #define LOG_TAG "VirtualCamera_JPEGStub_Compressor"
 #include <log/log.h>
 #include <libexif/exif-data.h>
diff --git a/src/jpeg-stub/JpegStub.cpp b/src/jpeg-stub/JpegStub.cpp
index d421a87..5c88a5e 100644
--- a/src/jpeg-stub/JpegStub.cpp
+++ b/src/jpeg-stub/JpegStub.cpp
@@ -16,7 +16,7 @@
 
 #include "JpegStub.h"
 
-// #define LOG_NDEBUG 0
+//#define LOG_NDEBUG 0
 #define LOG_TAG "VirtualCamera_JPEGStub"
 #include <errno.h>
 #include <log/log.h>
@@ -36,12 +36,11 @@ extern "C" void JpegStub_cleanup(JpegStub *stub) {
 extern "C" int JpegStub_compress(JpegStub *stub, const void *buffer, int width, int height,
                                  int quality, ExifData *exifData) {
     Compressor *compressor = reinterpret_cast<Compressor *>(stub->mCompressor);
-
     if (compressor->compress(reinterpret_cast<const unsigned char *>(buffer), width, height,
                              quality, exifData)) {
         ALOGV("%s: Compressed JPEG: %d[%dx%d] -> %zu bytes", __FUNCTION__,
               (width * height * 12) / 8, width, height, compressor->getCompressedData().size());
-        return 0;
+
     }
     ALOGE("%s: JPEG compression failed", __FUNCTION__);
     return errno ? errno : EINVAL;
-- 
2.17.1

