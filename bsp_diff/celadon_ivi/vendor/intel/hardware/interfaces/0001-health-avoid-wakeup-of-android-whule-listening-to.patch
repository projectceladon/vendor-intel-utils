From 237051f12f75b5bc60d7cc57e3d2d99a3f4f09ae Mon Sep 17 00:00:00 2001
From: Kaushlendra Kumar <kaushlendra.kumar@intel.com>
Date: Tue, 23 May 2023 10:01:13 +0530
Subject: [PATCH] health: avoid wakeup of android whule listening to NETLINK
 event

---
 health/2.0/healthd_common.cpp                 | 2 +-
 health/2.1/utils/libhealthloop/HealthLoop.cpp | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/health/2.0/healthd_common.cpp b/health/2.0/healthd_common.cpp
index d655395..71968ba 100644
--- a/health/2.0/healthd_common.cpp
+++ b/health/2.0/healthd_common.cpp
@@ -194,7 +194,7 @@ static void uevent_init(void) {
     }
 
     fcntl(uevent_fd, F_SETFL, O_NONBLOCK);
-    if (healthd_register_event(uevent_fd, uevent_event, EVENT_WAKEUP_FD))
+    if (healthd_register_event(uevent_fd, uevent_event, EVENT_NO_WAKEUP_FD))
         KLOG_ERROR(LOG_TAG, "register for uevent events failed\n");
 }
 
diff --git a/health/2.1/utils/libhealthloop/HealthLoop.cpp b/health/2.1/utils/libhealthloop/HealthLoop.cpp
index c4cda2b..2dbccf1 100644
--- a/health/2.1/utils/libhealthloop/HealthLoop.cpp
+++ b/health/2.1/utils/libhealthloop/HealthLoop.cpp
@@ -163,7 +163,7 @@ void HealthLoop::UeventInit(void) {
     }
 
     fcntl(uevent_fd_, F_SETFL, O_NONBLOCK);
-    if (RegisterEvent(uevent_fd_, &HealthLoop::UeventEvent, EVENT_WAKEUP_FD))
+    if (RegisterEvent(uevent_fd_, &HealthLoop::UeventEvent, EVENT_NO_WAKEUP_FD))
         KLOG_ERROR(LOG_TAG, "register for uevent events failed\n");
 }
 
-- 
2.40.1

