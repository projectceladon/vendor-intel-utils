From 62441fd1d84da8e689377a8a58cb469402c4a21b Mon Sep 17 00:00:00 2001
From: Raveendra Babu Chennakesavulu <raveendra.babu.chennakesavulu@intel.com>
Date: Fri, 24 Apr 2020 13:41:13 +0530
Subject: [PATCH] [REVERT ME] Add ethernet proxy with wifi proxy configured in
 UI

Tracked-On:
Signed-off-by: Raveendra Babu Chennakesavulu
                        <raveendra.babu.chennakesavulu@intel.com>

diff --git a/src/com/android/settings/wifi/WifiSettings.java b/src/com/android/settings/wifi/WifiSettings.java
index 8c4bfa28ad..2d43331f95 100644
--- a/src/com/android/settings/wifi/WifiSettings.java
+++ b/src/com/android/settings/wifi/WifiSettings.java
@@ -36,6 +36,10 @@ import android.net.NetworkRequest;
 import android.net.NetworkTemplate;
 import android.net.wifi.WifiConfiguration;
 import android.net.wifi.WifiManager;
+import android.net.EthernetManager;
+import android.net.IpConfiguration;
+import android.net.ProxyInfo;
+import android.net.IpConfiguration.ProxySettings;
 import android.os.Bundle;
 import android.os.Handler;
 import android.os.Looper;
@@ -135,6 +139,10 @@ public class WifiSettings extends RestrictedSettingsFragment
         setProgressBarVisible(false);
     };
 
+    //Raveendra
+    private EthernetManager mEthernetManager;
+    private IpConfiguration mIpConfiguration;
+
     protected WifiManager mWifiManager;
     private ConnectivityManager mConnectivityManager;
     private WifiManager.ActionListener mConnectListener;
@@ -1075,6 +1083,8 @@ public class WifiSettings extends RestrictedSettingsFragment
     /* package */ void submit(WifiConfigController configController) {
 
         final WifiConfiguration config = configController.getConfig();
+	final Context mContext = getContext();
+	final String mInterfaceName;
 
         if (config == null) {
             if (mSelectedAccessPoint != null
@@ -1090,6 +1100,22 @@ public class WifiSettings extends RestrictedSettingsFragment
             }
         }
 
+	mEthernetManager = (EthernetManager) mContext.getSystemService(Context.ETHERNET_SERVICE);
+	String[] ifaces = mEthernetManager.getAvailableInterfaces();
+        if (ifaces.length > 0) {
+            mInterfaceName = ifaces[0];
+	    Log.d(TAG, "Raveendra: submit, mInterfaceName: " + mInterfaceName);
+            mIpConfiguration = mEthernetManager.getConfiguration(mInterfaceName);
+
+	    mIpConfiguration.setProxySettings(ProxySettings.STATIC);
+	    ProxyInfo mHttpProxy = new ProxyInfo(config.getHttpProxy());
+	    mIpConfiguration.setHttpProxy(mHttpProxy);
+	    Log.d(TAG, "Raveendra: submit, mHttpProxy: " + mHttpProxy);
+	    if (mInterfaceName != null) {
+		mEthernetManager.setConfiguration(mInterfaceName, mIpConfiguration);
+	    }
+        }
+
         mWifiTracker.resumeScanning();
     }
 
-- 
2.17.1

