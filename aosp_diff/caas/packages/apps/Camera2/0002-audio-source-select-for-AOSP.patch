From be191938d75aa36d48ec24f00a2e2ccdefe658bc Mon Sep 17 00:00:00 2001
From: kbillore <kaushal.billore@intel.com>
Date: Fri, 3 Jul 2020 13:00:28 +0530
Subject: [PATCH] audio source select for AOSP

---
 src/com/android/camera/VideoModule.java | 22 ++++++++++++++++++++++
 1 file changed, 22 insertions(+)

diff --git a/src/com/android/camera/VideoModule.java b/src/com/android/camera/VideoModule.java
index e8222f6d3..6e8550613 100644
--- a/src/com/android/camera/VideoModule.java
+++ b/src/com/android/camera/VideoModule.java
@@ -34,6 +34,7 @@ import android.media.CamcorderProfile;
 import android.media.CameraProfile;
 import android.media.MediaRecorder;
 import android.net.Uri;
+import android.media.AudioDeviceInfo;
 import android.os.Build;
 import android.os.Bundle;
 import android.os.Handler;
@@ -1149,6 +1150,27 @@ public class VideoModule extends CameraModule
 
         setRecordLocation();
 
+
+        {
+            Context mContext = mActivity.getApplicationContext();
+            AudioManager mAudioManager =
+                    (AudioManager)mContext.getSystemService(Context.AUDIO_SERVICE);
+            AudioDeviceInfo[] deviceList =
+                    mAudioManager.getDevices(AudioManager.GET_DEVICES_INPUTS);
+            for (AudioDeviceInfo audioDeviceInfo : deviceList) {
+                System.out.println("shiva audio source loop "+audioDeviceInfo.getType() );
+                if (audioDeviceInfo.getType() == AudioDeviceInfo.TYPE_USB_DEVICE) {
+                    System.out.println("shiva Audio USB type selected ");
+                    mMediaRecorder.setPreferredDevice(audioDeviceInfo);
+                    break;
+                } else if (audioDeviceInfo.getType() == AudioDeviceInfo.TYPE_USB_HEADSET) {
+                    Log.d(TAG, "shiva Setting preferred device to TYPE_USB_HEADSET");
+                     mMediaRecorder.setPreferredDevice(audioDeviceInfo);
+                     break;
+                 }
+            }
+        }
+
         // Set output file.
         // Try Uri in the intent first. If it doesn't exist, use our own
         // instead.
-- 
2.17.1

