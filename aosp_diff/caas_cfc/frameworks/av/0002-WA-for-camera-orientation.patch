From 8e3bc68a614fd4af42a8500551c337e0d27caa2d Mon Sep 17 00:00:00 2001
From: gkdeepa <g.k.deepa@intel.com>
Date: Tue, 26 Oct 2021 00:53:21 +0530
Subject: [PATCH] WA for camera orientation

Tracked-On:
---
 camera/CameraUtils.cpp                                    | 8 +++++---
 .../camera/libcameraservice/api1/client2/Parameters.cpp   | 7 +++++--
 services/camera/libcameraservice/utils/ExifUtils.cpp      | 3 ++-
 3 files changed, 12 insertions(+), 6 deletions(-)

diff --git a/camera/CameraUtils.cpp b/camera/CameraUtils.cpp
index f9b1b37dc9..77b6a4c6de 100644
--- a/camera/CameraUtils.cpp
+++ b/camera/CameraUtils.cpp
@@ -15,7 +15,7 @@
  */
 
 #define LOG_TAG "CameraUtils"
-//#define LOG_NDEBUG 0
+#define LOG_NDEBUG 0
 
 #include <camera/CameraUtils.h>
 #include <media/hardware/HardwareAPI.h>
@@ -55,6 +55,7 @@ status_t CameraUtils::getRotationTransform(const CameraMetadata& staticInfo,
 
     bool mirror = (entryFacing.data.u8[0] == ANDROID_LENS_FACING_FRONT);
     int orientation = entry.data.i32[0];
+    ALOGE("getRotationTransform orientation %d mirror %u",orientation,mirror); 
     if (!mirror) {
         switch (orientation) {
             case 0:
@@ -91,8 +92,9 @@ status_t CameraUtils::getRotationTransform(const CameraMetadata& staticInfo,
                         NATIVE_WINDOW_TRANSFORM_ROT_180;
                 break;
             case 270:
-                flags = NATIVE_WINDOW_TRANSFORM_FLIP_H ^
-                        NATIVE_WINDOW_TRANSFORM_ROT_90;
+                //flags = NATIVE_WINDOW_TRANSFORM_FLIP_H ^
+                //        NATIVE_WINDOW_TRANSFORM_ROT_90;
+                flags = NATIVE_WINDOW_TRANSFORM_FLIP_H;
 
                 break;
             default:
diff --git a/services/camera/libcameraservice/api1/client2/Parameters.cpp b/services/camera/libcameraservice/api1/client2/Parameters.cpp
index dbc863b3ad..6c3be889e3 100644
--- a/services/camera/libcameraservice/api1/client2/Parameters.cpp
+++ b/services/camera/libcameraservice/api1/client2/Parameters.cpp
@@ -16,7 +16,7 @@
 
 #define LOG_TAG "Camera2-Parameters"
 #define ATRACE_TAG ATRACE_TAG_CAMERA
-// #define LOG_NDEBUG 0
+ #define LOG_NDEBUG 0
 
 #include <utils/Log.h>
 #include <utils/Trace.h>
@@ -2828,6 +2828,8 @@ bool Parameters::boolFromString(const char *boolStr) {
 }
 
 int Parameters::degToTransform(int degrees, bool mirror) {
+
+ALOGE("degToTransform degree %d mirror %u mirror",degrees,mirror);
     if (!mirror) {
         if (degrees == 0) return 0;
         else if (degrees == 90) return HAL_TRANSFORM_ROT_90;
@@ -2837,7 +2839,8 @@ int Parameters::degToTransform(int degrees, bool mirror) {
         if (degrees == 0) {           // FLIP_H and ROT_0
             return HAL_TRANSFORM_FLIP_H;
         } else if (degrees == 90) {   // FLIP_H and ROT_90
-            return HAL_TRANSFORM_FLIP_H | HAL_TRANSFORM_ROT_90;
+            //return HAL_TRANSFORM_FLIP_H | HAL_TRANSFORM_ROT_90;
+            return HAL_TRANSFORM_FLIP_H ;
         } else if (degrees == 180) {  // FLIP_H and ROT_180
             return HAL_TRANSFORM_FLIP_V;
         } else if (degrees == 270) {  // FLIP_H and ROT_270
diff --git a/services/camera/libcameraservice/utils/ExifUtils.cpp b/services/camera/libcameraservice/utils/ExifUtils.cpp
index 8a0303a8e0..4cf2ec94a2 100644
--- a/services/camera/libcameraservice/utils/ExifUtils.cpp
+++ b/services/camera/libcameraservice/utils/ExifUtils.cpp
@@ -16,7 +16,7 @@
 
 #define LOG_TAG "CameraServerExifUtils"
 #define ATRACE_TAG ATRACE_TAG_CAMERA
-//#define LOG_NDEBUG 0
+#define LOG_NDEBUG 0
 
 #include <cutils/log.h>
 
@@ -636,6 +636,7 @@ bool ExifUtilsImpl::setExposureBias(int32_t ev,
 
 bool ExifUtilsImpl::setOrientation(uint16_t degrees) {
     ExifOrientation value = ExifOrientation::ORIENTATION_0_DEGREES;
+ALOGE("degree EXIF utils %d",degrees);
     switch (degrees) {
         case 90:
             value = ExifOrientation::ORIENTATION_90_DEGREES;
-- 
2.17.1

