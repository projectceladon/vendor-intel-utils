From 982235bac7779417e276b296c38abfe242e36fec Mon Sep 17 00:00:00 2001
From: "Ai, Ting" <ting.a.ai@intel.com>
Date: Mon, 17 Jan 2022 15:48:30 +0800
Subject: [PATCH] Update policy for media provider

Defined p9fs2 in public folder
Allow mediaprovider to access 9p sharefolder

Tracked-On: OAM-100644
Signed-off-by: Ai, Ting <ting.a.ai@intel.com>
---
 private/mediaprovider_app.te | 4 ++++
 public/file.te               | 2 ++
 2 files changed, 6 insertions(+)

diff --git a/private/mediaprovider_app.te b/private/mediaprovider_app.te
index 5881255c9..39130bc97 100644
--- a/private/mediaprovider_app.te
+++ b/private/mediaprovider_app.te
@@ -45,5 +45,9 @@ allowxperm mediaprovider_app media_rw_data_file:{ dir file } ioctl {
 
 allow mediaprovider_app proc_filesystems:file r_file_perms;
 
+# Talk to 9P sharefolder
+allow mediaprovider_app p9fs2:file r_file_perms;
+allow mediaprovider_app p9fs2:dir r_dir_perms;
+
 #Allow MediaProvider to see if sdcardfs is in use
 get_prop(mediaprovider_app, storage_config_prop)
diff --git a/public/file.te b/public/file.te
index 7ed8baab6..a6f786f04 100644
--- a/public/file.te
+++ b/public/file.te
@@ -549,3 +549,5 @@ type audiohal_data_file, file_type, data_file_type, core_data_file_type;
 # Should be:
 #   type apk_data_file, file_type, data_file_type;
 neverallow fs_type file_type:filesystem associate;
+
+type p9fs2, fs_type, mlstrustedobject;
-- 
2.25.1

