From 09ba450905c3e4cf16b01500357e326f93aed68b Mon Sep 17 00:00:00 2001
From: xichen12 <xi.a.chen@intel.com>
Date: Thu, 4 Apr 2019 16:14:58 +0800
Subject: [PATCH] [r2_celadon_q][hibernation_file]Support sub-directory.

Tracked-On:
Signed-off-by: xichen12 <xi.a.chen@intel.com>
---
 fs_mgr/fs_mgr_fstab.cpp | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/fs_mgr/fs_mgr_fstab.cpp b/fs_mgr/fs_mgr_fstab.cpp
index 7df7cfd..d7e9b74 100644
--- a/fs_mgr/fs_mgr_fstab.cpp
+++ b/fs_mgr/fs_mgr_fstab.cpp
@@ -396,6 +396,16 @@ std::string ReadFstabFromDt() {
         }
         fstab_entry.push_back(value);
 
+        /* vendor!oem_config => vendor/oem_config */
+        char d_name[256];
+        strcpy(d_name, dp->d_name);
+        char *p = d_name;
+        while (*p) {
+            if (*p == '!')
+                *p = '/';
+            p ++;
+        }
+
         std::string mount_point;
         file_name =
             android::base::StringPrintf("%s/%s/mnt_point", fstabdir_name.c_str(), dp->d_name);
@@ -403,7 +413,7 @@ std::string ReadFstabFromDt() {
             LINFO << "dt_fstab: Using a specified mount point " << value << " for " << dp->d_name;
             mount_point = value;
         } else {
-            mount_point = android::base::StringPrintf("/%s", dp->d_name);
+            mount_point = android::base::StringPrintf("/%s", d_name);
         }
         fstab_entry.push_back(mount_point);
 
-- 
2.7.4

