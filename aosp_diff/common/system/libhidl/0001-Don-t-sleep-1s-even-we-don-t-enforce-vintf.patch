From 4652fb7ece2dfa9cd2c784ea6b3d55d6f502b7d3 Mon Sep 17 00:00:00 2001
From: Hongcheng Xie <hongcheng.xie@intel.com>
Date: Tue, 17 Nov 2020 14:22:29 +0800
Subject: [PATCH] Don't sleep 1s even we don't enforce vintf

Don't always warning and sleep 1s even we don't support
treble and enforce vintf, otherwise it will cause long
booting time and runtime performance issue.

Tracked-On: ACP-1374
Change-Id: I4575612ebfa7858239ebb42832dc0651fba31a6c
Signed-off-by: Hongcheng Xie <hongcheng.xie@intel.com>
---
 transport/ServiceManagement.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/transport/ServiceManagement.cpp b/transport/ServiceManagement.cpp
index d7faa6d..4032f9e 100644
--- a/transport/ServiceManagement.cpp
+++ b/transport/ServiceManagement.cpp
@@ -792,7 +792,7 @@ sp<::android::hidl::base::V1_0::IBase> getRawServiceInternal(const std::string&
     const bool allowLegacy = !kEnforceVintfManifest || (trebleTestingOverride && kDebuggable);
     const bool vintfLegacy = (transport == Transport::EMPTY) && allowLegacy;
 
-    if (!kEnforceVintfManifest) {
+    if (!kEnforceVintfManifest && false /* we don't support treble and enforce vintf */) {
         ALOGE("getService: Potential race detected. The VINTF manifest is not being enforced. If "
               "a HAL server has a delay in starting and it is not in the manifest, it will not be "
               "retrieved. Please make sure all HALs on this device are in the VINTF manifest and "
-- 
2.17.1

