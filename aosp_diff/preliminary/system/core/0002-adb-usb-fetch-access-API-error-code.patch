From c6fd75a0b88d23136fb7d31e83a39a9ec48f4122 Mon Sep 17 00:00:00 2001
From: Balaji M <m.balaji@intel.com>
Date: Mon, 8 Feb 2021 11:57:31 +0530
Subject: [PATCH] adb: usb: fetch access API error code

Do not merge.

Tracked-On:
Signed-off-by: Balaji M <m.balaji@intel.com>

diff --git a/adb/daemon/main.cpp b/adb/daemon/main.cpp
index ad660cf75..e745d7d71 100644
--- a/adb/daemon/main.cpp
+++ b/adb/daemon/main.cpp
@@ -241,6 +241,8 @@ int adbd_main(int server_port) {
 #if defined(__ANDROID__)
     if ((access(USB_FFS_ADB_EP0, F_OK) == 0) || (access(USB_DBC_ADB_PATH,F_OK) == 0)) {
         // Listen on USB.
+	//
+	LOG(INFO) << "Prabhat : inside adb main.;
         usb_init();
         is_usb = true;
     }
diff --git a/adb/daemon/usb.cpp b/adb/daemon/usb.cpp
index 9d4727554..5254479d9 100644
--- a/adb/daemon/usb.cpp
+++ b/adb/daemon/usb.cpp
@@ -178,7 +178,7 @@ struct UsbFfsConnection : public Connection {
           control_fd_(std::move(control)),
           read_fd_(std::move(read)),
           write_fd_(std::move(write)) {
-        LOG(INFO) << "UsbFfsConnection constructed";
+        LOG(INFO) << "Prabhat : UsbFfsConnection constructed;
         worker_event_fd_.reset(eventfd(0, EFD_CLOEXEC));
         if (worker_event_fd_ == -1) {
             PLOG(FATAL) << "failed to create eventfd";
@@ -778,7 +778,12 @@ static void usb_ffs_open_thread() {
 }
 
 void usb_init() {
-    if (access(USB_DBC_ADB_PATH,F_OK) == 0)
+    int err;
+    err = access(USB_DBC_ADB_PATH,F_OK);
+
+    LOG(INFO) << "Prabhat : dbc path access error no : " << err;
+
+    if (1)
         std::thread(usb_dbc_open_thread).detach();
     else
         std::thread(usb_ffs_open_thread).detach();
-- 
2.17.1

