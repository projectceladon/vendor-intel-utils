From ce44351e122e2ca80622db3b20f80e790f7fbbeb Mon Sep 17 00:00:00 2001
From: pmandri <padmasree.mandri@intel.com>
Date: Mon, 22 Feb 2021 11:38:20 +0530
Subject: [PATCH] Debug logs

Tracked-On:
Signed-off-by: pmandri <padmasree.mandri@intel.com>
---
 adb/daemon/main.cpp |  3 ++-
 adb/daemon/usb.cpp  | 11 ++++++++++-
 2 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/adb/daemon/main.cpp b/adb/daemon/main.cpp
index 7a0f7ffcd..626eeb709 100644
--- a/adb/daemon/main.cpp
+++ b/adb/daemon/main.cpp
@@ -239,8 +239,9 @@ int adbd_main(int server_port) {
     bool is_usb = false;
 
 #if defined(__ANDROID__)
-    if (access(USB_FFS_ADB_EP0, F_OK) == 0) {
+    if ((access(USB_FFS_ADB_EP0, F_OK) == 0) || (access(USB_DBC_ADB_PATH, F_OK) == 0)) {
         // Listen on USB.
+	LOG(INFO) << "Padma : inside adb main.";
         usb_init();
         is_usb = true;
     }
diff --git a/adb/daemon/usb.cpp b/adb/daemon/usb.cpp
index 50d73644d..00eadc3b1 100644
--- a/adb/daemon/usb.cpp
+++ b/adb/daemon/usb.cpp
@@ -178,6 +178,7 @@ struct UsbFfsConnection : public Connection {
           control_fd_(std::move(control)),
           read_fd_(std::move(read)),
           write_fd_(std::move(write)) {
+        LOG(INFO) << "Padma: UsbFfsConnection constructed";
         LOG(INFO) << "UsbFfsConnection constructed";
         worker_event_fd_.reset(eventfd(0, EFD_CLOEXEC));
         if (worker_event_fd_ == -1) {
@@ -762,5 +763,13 @@ static void usb_ffs_open_thread() {
 }
 
 void usb_init() {
-    std::thread(usb_ffs_open_thread).detach();
+    int err;
+    err = access(USB_DBC_ADB_PATH,F_OK);
+
+    LOG(INFO) << "Padma : dbc path access error no : " << err;
+
+    if (1)
+        std::thread(usb_dbc_open_thread).detach();
+    else
+        std::thread(usb_ffs_open_thread).detach();
 }
-- 
2.17.1

