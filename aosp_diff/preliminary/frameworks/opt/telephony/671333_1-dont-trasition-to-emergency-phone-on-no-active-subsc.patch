From 568a4d98c69ee971879551763cbff1d71fea483c Mon Sep 17 00:00:00 2001
From: Jeevaka Prabu Badrappan <jeevaka.badrappan@intel.com>
Date: Fri, 7 Jun 2019 02:40:25 +0530
Subject: [PATCH] dont trasition to emergency phone on no active subscriptions

Change-Id: Ic969f1af65d8b446f305d35b4cfc955920f76158
Tracked-On:
Signed-off-by: Jeevaka Prabu Badrappan <jeevaka.badrappan@intel.com>
---
 .../internal/telephony/PhoneSwitcher.java     | 20 -------------------
 1 file changed, 20 deletions(-)

diff --git a/src/java/com/android/internal/telephony/PhoneSwitcher.java b/src/java/com/android/internal/telephony/PhoneSwitcher.java
index 7bd24ee80..8ce38f7b5 100644
--- a/src/java/com/android/internal/telephony/PhoneSwitcher.java
+++ b/src/java/com/android/internal/telephony/PhoneSwitcher.java
@@ -765,15 +765,10 @@ public class PhoneSwitcher extends Handler {
             mPrimaryDataSubId = primaryDataSubId;
         }

-        // Check to see if there is any active subscription on any phone
-        boolean hasAnyActiveSubscription = false;
-
         // Check if phoneId to subId mapping is changed.
         for (int i = 0; i < mNumPhones; i++) {
             int sub = mSubscriptionController.getSubIdUsingPhoneId(i);

-            if (SubscriptionManager.isValidSubscriptionId(sub)) hasAnyActiveSubscription = true;
-
             if (sub != mPhoneSubscriptions[i]) {
                 sb.append(" phone[").append(i).append("] ").append(mPhoneSubscriptions[i]);
                 sb.append("->").append(sub);
@@ -781,23 +776,8 @@ public class PhoneSwitcher extends Handler {
                 diffDetected = true;
             }
         }
-
-        if (!hasAnyActiveSubscription) {
-            transitionToEmergencyPhone();
-        } else {
-            if (VDBG) log("Found an active subscription");
-        }
-
         // Check if phoneId for preferred data is changed.
         int oldPreferredDataPhoneId = mPreferredDataPhoneId;
-
-        // When there are no subscriptions, the preferred data phone ID is invalid, but we want
-        // to keep a valid phoneId for Emergency, so skip logic that updates for preferred data
-        // phone ID. Ideally there should be a single set of checks that evaluate the correct
-        // phoneId on a service-by-service basis (EIMS being one), but for now... just bypass
-        // this logic in the no-SIM case.
-        if (hasAnyActiveSubscription) updatePreferredDataPhoneId();
-
         if (oldPreferredDataPhoneId != mPreferredDataPhoneId) {
             sb.append(" preferred phoneId ").append(oldPreferredDataPhoneId)
                     .append("->").append(mPreferredDataPhoneId);
--
2.21.0
