From dfe75b5caaf46fca121e3edd037a83a1a1f2b70e Mon Sep 17 00:00:00 2001
From: mayankkk <mayankkk@google.com>
Date: Tue, 3 Dec 2024 17:36:14 -0800
Subject: [PATCH] Don't allow non-system uids to use "android" as calling
 package.

Bug: 310632322
Test: atest ./BroadcastsSecurityTest/src/android/app/cts/broadcasts/BroadcastRegistrationTest.java
Flag: EXEMPT bugfix
(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:84e975cf12759d04863e35abf51a94356c6b4c25)
Merged-In: I83537fde6cad2073e767d56c27cd25b82f29c235
Change-Id: I83537fde6cad2073e767d56c27cd25b82f29c235
---
 .../java/com/android/server/am/ActivityManagerService.java     | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/services/core/java/com/android/server/am/ActivityManagerService.java b/services/core/java/com/android/server/am/ActivityManagerService.java
index b75e845e721c..a5587eefeae4 100644
--- a/services/core/java/com/android/server/am/ActivityManagerService.java
+++ b/services/core/java/com/android/server/am/ActivityManagerService.java
@@ -13162,8 +13162,7 @@ public class ActivityManagerService extends IActivityManager.Stub
                             + ") when registering receiver " + receiver);
                 }
                 if (callerApp.info.uid != SYSTEM_UID
-                        && !callerApp.getPkgList().containsKey(callerPackage)
-                        && !"android".equals(callerPackage)) {
+                        && !callerApp.getPkgList().containsKey(callerPackage)) {
                     throw new SecurityException("Given caller package " + callerPackage
                             + " is not running in process " + callerApp);
                 }
-- 
2.49.0.395.g12beb8f557-goog

