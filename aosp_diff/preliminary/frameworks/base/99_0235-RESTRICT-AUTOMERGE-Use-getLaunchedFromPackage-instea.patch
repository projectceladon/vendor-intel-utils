From b042ad21836a82d0d5d5e5512c3b9d91675811b2 Mon Sep 17 00:00:00 2001
From: Marvin Ramin <marvinramin@google.com>
Date: Wed, 16 Oct 2024 12:26:02 +0200
Subject: [PATCH] RESTRICT AUTOMERGE Use getLaunchedFromPackage instead of
 getCallingPackage

Ensure that MediaProjectionPermissionActivity is doing proper
attribution and validation of permissions before showing.

Bug: 372670004
Bug: 373581993
Test: presubmit
(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:90a18efc9386e4a8b1e99a48ebec60361b37c376)
Merged-In: I48adb14fbc8d5f2f2e21ef8a30a713d33f03ab02
Change-Id: I48adb14fbc8d5f2f2e21ef8a30a713d33f03ab02
---
 .../systemui/media/MediaProjectionPermissionActivity.java     | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/media/MediaProjectionPermissionActivity.java b/packages/SystemUI/src/com/android/systemui/media/MediaProjectionPermissionActivity.java
index bfa67a89baca..a9a3eb8f3575 100644
--- a/packages/SystemUI/src/com/android/systemui/media/MediaProjectionPermissionActivity.java
+++ b/packages/SystemUI/src/com/android/systemui/media/MediaProjectionPermissionActivity.java
@@ -70,11 +70,11 @@ public class MediaProjectionPermissionActivity extends Activity
         super.onCreate(icicle);
 
         mFeatureFlags = Dependency.get(FeatureFlags.class);
-        mPackageName = getCallingPackage();
+        mPackageName = getLaunchedFromPackage();
         IBinder b = ServiceManager.getService(MEDIA_PROJECTION_SERVICE);
         mService = IMediaProjectionManager.Stub.asInterface(b);
 
-        if (mPackageName == null) {
+        if (getCallingPackage() == null) {
             finish();
             return;
         }
-- 
2.34.1

