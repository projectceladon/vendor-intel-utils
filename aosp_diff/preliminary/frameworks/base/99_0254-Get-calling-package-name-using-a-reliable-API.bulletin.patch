From e417481d55cfb4e410bdcdbc399115e3ce809bab Mon Sep 17 00:00:00 2001
From: Sumedh Sen <sumedhsen@google.com>
Date: Thu, 16 Jan 2025 11:38:56 -0800
Subject: [PATCH] Get calling package name using a reliable API

getCallingPackage() is unreliable due to reasons listed here:
go/getcallingpackage-misuse. Replace it with getLaunchedFromPackage

Test: Manual. Install an APK and ensure app is installed
Bug: 364604008
(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:934ceb1dc4ee64d6bf3bf16e63e5ec4861be20ca)
Merged-In: If94ea6566fa3f3b461efaeffff7b074693003c9a
Change-Id: If94ea6566fa3f3b461efaeffff7b074693003c9a
---
 .../src/com/android/packageinstaller/InstallStart.java          | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/packages/PackageInstaller/src/com/android/packageinstaller/InstallStart.java b/packages/PackageInstaller/src/com/android/packageinstaller/InstallStart.java
index af05078b4f3a..5f03410c8d5d 100644
--- a/packages/PackageInstaller/src/com/android/packageinstaller/InstallStart.java
+++ b/packages/PackageInstaller/src/com/android/packageinstaller/InstallStart.java
@@ -56,7 +56,7 @@ public class InstallStart extends Activity {
         mPackageManager = getPackageManager();
         mUserManager = getSystemService(UserManager.class);
         Intent intent = getIntent();
-        String callingPackage = getCallingPackage();
+        String callingPackage = getLaunchedFromPackage();
         String callingAttributionTag = null;
 
         final boolean isSessionInstall =
-- 
2.49.0.395.g12beb8f557-goog

