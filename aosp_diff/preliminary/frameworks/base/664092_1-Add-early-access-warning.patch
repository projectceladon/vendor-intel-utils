From 4c471e3552d552eb9c9f5a8f9ab5924916736cb9 Mon Sep 17 00:00:00 2001
From: Hongcheng Xie <hongcheng.xie@intel.com>
Date: Tue, 5 Mar 2019 10:18:37 +0800
Subject: [PATCH 1/3] Add early access warning

Change-Id: Ie6d8ffd06a08e7e896d24d2f544d34a7cdfc759b
Tracked-On:
Signed-off-by: Hongcheng Xie <hongcheng.xie@intel.com>
---
 core/res/res/layout/early_access.xml          | 26 +++++++++++++++++++
 core/res/res/values/symbols.xml               |  1 +
 .../server/am/ActivityManagerService.java     | 16 ++++++++++++
 .../java/com/android/server/SystemServer.java |  3 +++
 4 files changed, 46 insertions(+)
 create mode 100644 core/res/res/layout/early_access.xml

diff --git a/core/res/res/layout/early_access.xml b/core/res/res/layout/early_access.xml
new file mode 100644
index 00000000000..db6a93fc148
--- /dev/null
+++ b/core/res/res/layout/early_access.xml
@@ -0,0 +1,26 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2006 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<TextView xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="wrap_content" android:layout_height="wrap_content"
+    android:textAppearance="?android:attr/textAppearanceLarge"
+    android:gravity="center"
+    android:padding="3dp"
+    android:background="@drawable/safe_mode_background"
+    android:textColor="#ffff0000"
+    android:text="WARNING!!!! Please never release Q info out of Intel until Google publish Q dessert, currently Q is early access !!!"
+    android:textSize="30dp"
+/>
diff --git a/core/res/res/values/symbols.xml b/core/res/res/values/symbols.xml
index 9d75654d2a1..eb143229d57 100644
--- a/core/res/res/values/symbols.xml
+++ b/core/res/res/values/symbols.xml
@@ -2056,6 +2056,7 @@
   <java-symbol type="layout" name="am_compat_mode_dialog" />
   <java-symbol type="layout" name="launch_warning" />
   <java-symbol type="layout" name="safe_mode" />
+  <java-symbol type="layout" name="early_access" />
   <java-symbol type="layout" name="simple_list_item_2_single_choice" />
   <java-symbol type="layout" name="app_error_dialog" />
   <java-symbol type="plurals" name="wifi_available" />
diff --git a/services/core/java/com/android/server/am/ActivityManagerService.java b/services/core/java/com/android/server/am/ActivityManagerService.java
index 627ca911f9b..4b022eff9b9 100644
--- a/services/core/java/com/android/server/am/ActivityManagerService.java
+++ b/services/core/java/com/android/server/am/ActivityManagerService.java
@@ -8442,6 +8442,22 @@ public class ActivityManagerService extends IActivityManager.Stub
                 Context.WINDOW_SERVICE)).addView(v, lp);
     }

+    public final void showEarlyAccessWarning() {
+        View v = LayoutInflater.from(mContext).inflate(
+                com.android.internal.R.layout.early_access, null);
+        WindowManager.LayoutParams lp = new WindowManager.LayoutParams();
+        lp.type = WindowManager.LayoutParams.TYPE_SECURE_SYSTEM_OVERLAY;
+        lp.width = WindowManager.LayoutParams.WRAP_CONTENT;
+        lp.height = WindowManager.LayoutParams.WRAP_CONTENT;
+        lp.gravity = Gravity.CENTER_VERTICAL | Gravity.CENTER_HORIZONTAL;
+        lp.format = v.getBackground().getOpacity();
+        lp.flags = WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE
+                | WindowManager.LayoutParams.FLAG_NOT_TOUCHABLE;
+        lp.privateFlags |= WindowManager.LayoutParams.PRIVATE_FLAG_SHOW_FOR_ALL_USERS;
+        ((WindowManager)mContext.getSystemService(
+                Context.WINDOW_SERVICE)).addView(v, lp);
+    }
+
     @Override
     public void noteWakeupAlarm(IIntentSender sender, WorkSource workSource, int sourceUid,
             String sourcePkg, String tag) {
diff --git a/services/java/com/android/server/SystemServer.java b/services/java/com/android/server/SystemServer.java
index 6dd85270e7e..2c754c4f318 100644
--- a/services/java/com/android/server/SystemServer.java
+++ b/services/java/com/android/server/SystemServer.java
@@ -1945,6 +1945,9 @@ public final class SystemServer {
             mActivityManagerService.showSafeModeOverlay();
         }

+        // Show Android new dessert early access warning
+        mActivityManagerService.showEarlyAccessWarning();
+
         // Update the configuration for this context by hand, because we're going
         // to start using it before the config change done in wm.systemReady() will
         // propagate to it.
--
2.21.0
