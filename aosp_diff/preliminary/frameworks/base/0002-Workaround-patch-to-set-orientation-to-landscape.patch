From 28c52f1fcaf96ff672a2fadb8fa6837a9a67fe5c Mon Sep 17 00:00:00 2001
From: xubing <bing.xu@intel.com>
Date: Wed, 13 Sep 2023 11:13:00 +0800
Subject: [PATCH] Workaround patch to set orientation to landscape.

Signed-off-by: xubing <bing.xu@intel.com>
---
 .../content/pm/parsing/component/ParsedActivityUtils.java    | 5 +++++
 .../java/com/android/server/wm/ActivityClientController.java | 4 ++++
 2 files changed, 9 insertions(+)

diff --git a/core/java/android/content/pm/parsing/component/ParsedActivityUtils.java b/core/java/android/content/pm/parsing/component/ParsedActivityUtils.java
index 92a90e98cb43..53e920ae4def 100644
--- a/core/java/android/content/pm/parsing/component/ParsedActivityUtils.java
+++ b/core/java/android/content/pm/parsing/component/ParsedActivityUtils.java
@@ -169,6 +169,11 @@ public class ParsedActivityUtils {
                         sa.getInt(R.styleable.AndroidManifestActivity_recreateOnConfigChanges, 0));
 
                 int screenOrientation = sa.getInt(R.styleable.AndroidManifestActivity_screenOrientation, SCREEN_ORIENTATION_UNSPECIFIED);
+                if(screenOrientation == 1) {
+                    Log.w(TAG , "Enforce set screenOrientation to landscape..... ");
+                    screenOrientation = 0;
+                }
+
                 int resizeMode = getActivityResizeMode(pkg, sa, screenOrientation);
                 activity.screenOrientation = screenOrientation;
                 activity.resizeMode = resizeMode;
diff --git a/services/core/java/com/android/server/wm/ActivityClientController.java b/services/core/java/com/android/server/wm/ActivityClientController.java
index ee72fc8622a5..09779097370f 100644
--- a/services/core/java/com/android/server/wm/ActivityClientController.java
+++ b/services/core/java/com/android/server/wm/ActivityClientController.java
@@ -636,6 +636,10 @@ class ActivityClientController extends IActivityClientController.Stub {
             synchronized (mGlobalLock) {
                 final ActivityRecord r = ActivityRecord.isInRootTaskLocked(token);
                 if (r != null) {
+                    if (requestedOrientation == 1) {
+                        requestedOrientation =0;
+                        Slog.v("ActivityClientController", "Force set orientation to landscape....");
+                    }
                     r.setRequestedOrientation(requestedOrientation);
                 }
             }
-- 
2.34.1

