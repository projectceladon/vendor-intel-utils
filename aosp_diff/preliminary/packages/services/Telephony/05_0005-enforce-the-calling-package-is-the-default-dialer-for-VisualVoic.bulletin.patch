From 49a83909c74db7a4d783926631e3ab7cc4ab7360 Mon Sep 17 00:00:00 2001
From: Thomas Stuart <tjstuart@google.com>
Date: Thu, 6 Jun 2024 22:34:33 +0000
Subject: [PATCH] enforce the calling package is the default dialer for
 VisualVoicemail

In the docs for setVisualVoicemailSmsFilterSettings, they state that
the callingPackage needs to be the default dialer. However, server side,
there is no enforcement for this. Now, every client is verified to be
the default dialer, system dialer, or carrier visual voicemail app
before changing the settings for visual voicemail.

Bug: 308932906
Test: CTS
(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:17a3adcb99b587027be2bebe9718457df689b4b4)
Merged-In: I951d7783f5c425c03768efb7aee7a38e299e6536
Change-Id: I951d7783f5c425c03768efb7aee7a38e299e6536
---
 src/com/android/phone/PhoneInterfaceManager.java | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/com/android/phone/PhoneInterfaceManager.java b/src/com/android/phone/PhoneInterfaceManager.java
index 66cef648e..ad0a4e586 100755
--- a/src/com/android/phone/PhoneInterfaceManager.java
+++ b/src/com/android/phone/PhoneInterfaceManager.java
@@ -3788,7 +3788,7 @@ public class PhoneInterfaceManager extends ITelephony.Stub {
     public void enableVisualVoicemailSmsFilter(String callingPackage, int subId,
             VisualVoicemailSmsFilterSettings settings) {
         mAppOps.checkPackage(Binder.getCallingUid(), callingPackage);
-
+        enforceVisualVoicemailPackage(callingPackage, subId);
         final long identity = Binder.clearCallingIdentity();
         try {
             VisualVoicemailSmsFilterConfig.enableVisualVoicemailSmsFilter(
@@ -3801,7 +3801,7 @@ public class PhoneInterfaceManager extends ITelephony.Stub {
     @Override
     public void disableVisualVoicemailSmsFilter(String callingPackage, int subId) {
         mAppOps.checkPackage(Binder.getCallingUid(), callingPackage);
-
+        enforceVisualVoicemailPackage(callingPackage, subId);
         final long identity = Binder.clearCallingIdentity();
         try {
             VisualVoicemailSmsFilterConfig.disableVisualVoicemailSmsFilter(
-- 
2.46.1.824.gd892dcdcdd-goog

