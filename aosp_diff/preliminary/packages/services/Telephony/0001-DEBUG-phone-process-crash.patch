From e56bd7295af4f17698747565d7f52fd7f242405a Mon Sep 17 00:00:00 2001
From: Jeevaka Prabu Badrappan <jeevaka.badrappan@intel.com>
Date: Sat, 10 Sep 2022 15:19:18 +0530
Subject: [PATCH] [DEBUG] phone process crash

Tracked-On:
Signed-off-by: Jeevaka Prabu Badrappan <jeevaka.badrappan@intel.com>
---
 src/com/android/phone/PhoneGlobals.java | 29 +++++++++++++++----------
 1 file changed, 18 insertions(+), 11 deletions(-)

diff --git a/src/com/android/phone/PhoneGlobals.java b/src/com/android/phone/PhoneGlobals.java
index 99e73ff9f..6f8d71a12 100644
--- a/src/com/android/phone/PhoneGlobals.java
+++ b/src/com/android/phone/PhoneGlobals.java
@@ -361,6 +361,7 @@ public class PhoneGlobals extends ContextWrapper {
                     break;
                 case EVENT_CARRIER_CONFIG_CHANGED:
                     int subId = (Integer) msg.obj;
+                    Log.i(LOG_TAG, "Jeeva EVENT_CARRIER_CONFIG_CHANGED, subId: " + subId);
                     // The voicemail number could be overridden by carrier config, so need to
                     // refresh the message waiting (voicemail) indicator.
                     refreshMwiIndicator(subId);
@@ -385,6 +386,7 @@ public class PhoneGlobals extends ContextWrapper {
                     break;
                 case EVENT_MULTI_SIM_CONFIG_CHANGED:
                     int activeModems = (int) ((AsyncResult) msg.obj).result;
+                    Log.i(LOG_TAG, "Jeeva EVENT_MULTI_SIM_CONFIG_CHANGED, activeModems: " + activeModems);
                     TelephonyManager tm = getSystemService(TelephonyManager.class);
                     // Unregister all previous callbacks
                     for (int phoneId = 0; phoneId < mTelephonyCallbacks.length; phoneId++) {
@@ -545,17 +547,22 @@ public class PhoneGlobals extends ContextWrapper {
             intentFilter.addAction(CarrierConfigManager.ACTION_CARRIER_CONFIG_CHANGED);
             registerReceiver(mReceiver, intentFilter);
 
-            PhoneConfigurationManager.registerForMultiSimConfigChange(
-                    mHandler, EVENT_MULTI_SIM_CONFIG_CHANGED, null);
-
-            mTelephonyCallbacks = new PhoneAppCallback[tm.getSupportedModemCount()];
-
-            for (Phone phone : PhoneFactory.getPhones()) {
-                int subId = phone.getSubId();
-                PhoneAppCallback callback = new PhoneAppCallback(subId);
-                tm.createForSubscriptionId(subId).registerTelephonyCallback(
-                        TelephonyManager.INCLUDE_LOCATION_DATA_NONE, mHandler::post, callback);
-                mTelephonyCallbacks[phone.getPhoneId()] = callback;
+            Log.i(LOG_TAG, "Jeeva ModemCount: " + tm.getSupportedModemCount());
+            if (tm.getSupportedModemCount() > 0) {
+                PhoneConfigurationManager.registerForMultiSimConfigChange(
+                        mHandler, EVENT_MULTI_SIM_CONFIG_CHANGED, null);
+
+                mTelephonyCallbacks = new PhoneAppCallback[tm.getSupportedModemCount()];
+
+                for (Phone phone : PhoneFactory.getPhones()) {
+                    int subId = phone.getSubId();
+                    Log.i(LOG_TAG, "Jeeva phoneId: " + phone.getPhoneId());
+                    Log.i(LOG_TAG, "Jeeva subId: " + phone.getSubId());
+                    PhoneAppCallback callback = new PhoneAppCallback(subId);
+                    tm.createForSubscriptionId(subId).registerTelephonyCallback(
+                            TelephonyManager.INCLUDE_LOCATION_DATA_NONE, mHandler::post, callback);
+                    mTelephonyCallbacks[phone.getPhoneId()] = callback;
+                }
             }
 
             mCarrierVvmPackageInstalledReceiver.register(this);
-- 
2.35.1

