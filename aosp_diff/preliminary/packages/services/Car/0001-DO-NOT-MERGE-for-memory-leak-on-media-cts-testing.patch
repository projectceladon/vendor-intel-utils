From 0b84605abd337b42ff5594062db8b6a6d190f953 Mon Sep 17 00:00:00 2001
From: renchenglei <chenglei.ren@intel.com>
Date: Thu, 28 Jan 2021 17:57:32 +0800
Subject: [PATCH] [DO NOT MERGE] for memory leak on media cts testing

Tracked-On:
---
 .../src/com/android/car/SystemActivityMonitoringService.java | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/service/src/com/android/car/SystemActivityMonitoringService.java b/service/src/com/android/car/SystemActivityMonitoringService.java
index 418dd3b7c4b1..1cba5b6a026e 100644
--- a/service/src/com/android/car/SystemActivityMonitoringService.java
+++ b/service/src/com/android/car/SystemActivityMonitoringService.java
@@ -19,6 +19,7 @@ import static com.android.car.pm.CarPackageManagerService.BLOCKING_INTENT_EXTRA_
 
 import android.app.ActivityManager;
 import android.app.ActivityManager.StackInfo;
+import android.app.ActivityManager.TaskSnapshot;
 import android.app.ActivityOptions;
 import android.app.IActivityManager;
 import android.app.IProcessObserver;
@@ -465,6 +466,10 @@ public class SystemActivityMonitoringService implements CarServiceBase {
             }
             mHandler.requestUpdatingTask();
         }
+	@Override
+	public void onTaskSnapshotChanged(int taskId, TaskSnapshot snapshot) {
+	    snapshot.getSnapshot().destroy();
+	}
     }
 
     private static final class ActivityMonitorHandler extends Handler {
-- 
2.17.1

