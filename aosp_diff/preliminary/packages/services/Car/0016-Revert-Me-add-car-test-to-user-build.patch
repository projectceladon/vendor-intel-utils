From 6227fdfbc6264c08ee88f583074ba2c45ef751d0 Mon Sep 17 00:00:00 2001
From: Qi Zhang <qi1.zhang@intel.com>
Date: Wed, 11 Oct 2023 09:40:21 +0800
Subject: [PATCH] [Revert Me] add car test to user build

Signed-off-by: Qi Zhang <qi1.zhang@intel.com>
---
 car_product/build/car.mk                                  | 4 ++--
 .../android/car/kitchensink/power/PowerTestFragment.java  | 8 +++++---
 2 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/car_product/build/car.mk b/car_product/build/car.mk
index f24aaa7d3..0bd2f18db 100644
--- a/car_product/build/car.mk
+++ b/car_product/build/car.mk
@@ -37,7 +37,7 @@ PRODUCT_PACKAGES += \
     screenrecord
 
 # This is for testing
-ifneq (,$(filter userdebug eng, $(TARGET_BUILD_VARIANT)))
+#ifneq (,$(filter userdebug eng, $(TARGET_BUILD_VARIANT)))
 PRODUCT_PACKAGES += \
     DefaultStorageMonitoringCompanionApp \
     EmbeddedKitchenSinkApp \
@@ -51,7 +51,7 @@ PRODUCT_PACKAGES += \
 
 # SEPolicy for test apps / services
 BOARD_SEPOLICY_DIRS += packages/services/Car/car_product/sepolicy/test
-endif
+#endif
 
 # ClusterOsDouble is the testing app to test Cluster2 framework and it can handle Cluster VHAL
 # and do some Cluster OS role.
diff --git a/tests/EmbeddedKitchenSinkApp/src/com/google/android/car/kitchensink/power/PowerTestFragment.java b/tests/EmbeddedKitchenSinkApp/src/com/google/android/car/kitchensink/power/PowerTestFragment.java
index a59d43bc6..4ee5256d5 100644
--- a/tests/EmbeddedKitchenSinkApp/src/com/google/android/car/kitchensink/power/PowerTestFragment.java
+++ b/tests/EmbeddedKitchenSinkApp/src/com/google/android/car/kitchensink/power/PowerTestFragment.java
@@ -22,6 +22,7 @@ import android.os.Bundle;
 import android.os.Handler;
 import android.os.PowerManager;
 import android.os.SystemClock;
+import android.os.SystemProperties;
 import android.util.Log;
 import android.view.LayoutInflater;
 import android.view.View;
@@ -103,8 +104,9 @@ public class PowerTestFragment extends Fragment {
         }
         // NOTE:  This doesn't really work to sleep the device.  Actual sleep is implemented via
         //  SystemInterface via libsuspend::force_suspend()
-        PowerManager pm = (PowerManager) getActivity().getSystemService(Context.POWER_SERVICE);
-        pm.goToSleep(SystemClock.uptimeMillis(), PowerManager.GO_TO_SLEEP_REASON_DEVICE_ADMIN,
-                     PowerManager.GO_TO_SLEEP_FLAG_NO_DOZE);
+        //PowerManager pm = (PowerManager) getActivity().getSystemService(Context.POWER_SERVICE);
+        //pm.goToSleep(SystemClock.uptimeMillis(), PowerManager.GO_TO_SLEEP_REASON_DEVICE_ADMIN,
+        //             PowerManager.GO_TO_SLEEP_FLAG_NO_DOZE);
+	SystemProperties.set("sys.force.s3", "1");
     }
 }
-- 
2.34.1

