From 795cdea6838a97c954fa4896d352b32cf9f5bad4 Mon Sep 17 00:00:00 2001
From: Adam Bookatz <bookatz@google.com>
Date: Mon, 18 Nov 2024 15:53:41 -0800
Subject: [PATCH] Don't let profiles open the UserSettings overflow [DO NOT
 MERGE]

Really, profiles aren't expected to open Settings at all. But if they
do somehow, the overflow shouldn't appear.

Bug: 352542820
Flag: EXEMPT bugfix
Test: Try to access the overflow of the work profile by launching its Settings in
adb shell am start --user 10 'com.android.settings/.Settings\$UserSettingsActivity'

(cherry picked from commit 69c7f5dac580361792bbb189178653b297d06c8a)
(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:26c7101a0e26266acadf063f3871b48ba13d986b)
Merged-In: I5e4c095cda3e19fa5c63c2c550a526f5da8ec5c1
Change-Id: I5e4c095cda3e19fa5c63c2c550a526f5da8ec5c1
---
 src/com/android/settings/users/UserSettings.java | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/com/android/settings/users/UserSettings.java b/src/com/android/settings/users/UserSettings.java
index 28e02ec16e..b430068a7e 100644
--- a/src/com/android/settings/users/UserSettings.java
+++ b/src/com/android/settings/users/UserSettings.java
@@ -464,7 +464,8 @@ public class UserSettings extends SettingsPreferenceFragment
     @Override
     public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
         int pos = 0;
-        if (!isCurrentUserAdmin() && canSwitchUserNow() && !isCurrentUserGuest()) {
+        if (!isCurrentUserAdmin() && canSwitchUserNow() && !isCurrentUserGuest()
+                && !mUserManager.isProfile()) {
             String nickname = mUserManager.getUserName();
             MenuItem removeThisUser = menu.add(0, MENU_REMOVE_USER, pos++,
                     getResources().getString(R.string.user_remove_user_menu, nickname));
-- 
2.47.1.613.gc27f4b7a9f-goog

