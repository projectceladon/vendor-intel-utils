From 1c3ad205a969163002f42b61f00d66ee38e1fab2 Mon Sep 17 00:00:00 2001
From: "Unnithan, Balakrishnan" <balakrishnan.unnithan@intel.com>
Date: Mon, 16 Dec 2024 15:00:43 +0530
Subject: [PATCH 9/9] fix ota update failure after vabc compression enable

Signed-off-by: Unnithan, Balakrishnan <balakrishnan.unnithan@intel.com>
---
 target/product/virtual_ab_ota/vabc_features.mk | 14 ++++++++++----
 1 file changed, 10 insertions(+), 4 deletions(-)

diff --git a/target/product/virtual_ab_ota/vabc_features.mk b/target/product/virtual_ab_ota/vabc_features.mk
index 7b90106fbd..faf347ebe6 100644
--- a/target/product/virtual_ab_ota/vabc_features.mk
+++ b/target/product/virtual_ab_ota/vabc_features.mk
@@ -52,11 +52,17 @@ PRODUCT_VENDOR_PROPERTIES += ro.virtual_ab.batch_writes=true
 
 # Enabling this property, will improve OTA install time
 # but will use an additional CPU core
-PRODUCT_VENDOR_PROPERTIES += ro.virtual_ab.compression.threads=true
-
+# PRODUCT_VENDOR_PROPERTIES += ro.virtual_ab.compression.threads=true
+#
 PRODUCT_VIRTUAL_AB_COMPRESSION := true
-PRODUCT_VIRTUAL_AB_COMPRESSION_METHOD ?= lz4
-PRODUCT_VIRTUAL_AB_COMPRESSION_FACTOR ?= 65536
+
+ifndef PRODUCT_VIRTUAL_AB_COMPRESSION_FACTOR
+    PRODUCT_VIRTUAL_AB_COMPRESSION_FACTOR := 65536
+endif
+
+ifndef PRODUCT_VIRTUAL_AB_COMPRESSION_METHOD
+    PRODUCT_VIRTUAL_AB_COMPRESSION_METHOD := lz4
+endif
 
 PRODUCT_PACKAGES += \
     snapuserd.vendor_ramdisk \
-- 
2.47.1

