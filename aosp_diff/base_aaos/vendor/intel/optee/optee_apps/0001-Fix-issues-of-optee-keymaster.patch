From 4bbbedf788b2c740a324866d480f346608164c12 Mon Sep 17 00:00:00 2001
From: "Yan, Shaopu" <shaopu.yan@intel.com>
Date: Wed, 6 Mar 2024 22:13:06 +0800
Subject: [PATCH] Fix issues of optee keymaster

- fix the initialization issue of resultParams
- make the build pass for optee keymaster
- disabled the gatekeeper build for currently

Tracked-On: OAM-116519
Signed-off-by: Yan, Shaopu <shaopu.yan@intel.com>
---
 gatekeeper/Android.mk                   | 2 +-
 keymaster/3.0/OpteeKeymaster3Device.cpp | 2 +-
 keymaster/Android.mk                    | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/gatekeeper/Android.mk b/gatekeeper/Android.mk
index 69b8604..9f2daee 100644
--- a/gatekeeper/Android.mk
+++ b/gatekeeper/Android.mk
@@ -59,6 +59,6 @@ include $(BUILD_EXECUTABLE)
 ################################################################################
 # Build gatekeeper HAL TA                                                      #
 ################################################################################
-include $(LOCAL_PATH)/ta/Android.mk
+#include $(LOCAL_PATH)/ta/Android.mk
 
 #endif # Include only for HiKey ones.
diff --git a/keymaster/3.0/OpteeKeymaster3Device.cpp b/keymaster/3.0/OpteeKeymaster3Device.cpp
index 5e7eff3..874f0dc 100644
--- a/keymaster/3.0/OpteeKeymaster3Device.cpp
+++ b/keymaster/3.0/OpteeKeymaster3Device.cpp
@@ -384,7 +384,7 @@ Return<void> OpteeKeymaster3Device::begin(KeyPurpose purpose, const hidl_vec<uin
     BeginOperationResponse response(impl_->message_version());
     impl_->BeginOperation(request, &response);
 
-    hidl_vec<KeyParameter> resultParams(impl_->message_version());
+    hidl_vec<KeyParameter> resultParams;
     if (response.error == KM_ERROR_OK) {
         resultParams = kmParamSet2Hidl(response.output_params);
     }
diff --git a/keymaster/Android.mk b/keymaster/Android.mk
index d3120df..4e0a471 100644
--- a/keymaster/Android.mk
+++ b/keymaster/Android.mk
@@ -22,6 +22,6 @@ LOCAL_PATH:= $(call my-dir)
 ################################################################################
 # Build keymaster HAL TA                                                       #
 ################################################################################
-include $(LOCAL_PATH)/ta/Android.mk
+#include $(LOCAL_PATH)/ta/Android.mk
 
 #endif # Include only for HiKey ones.
-- 
2.25.1

