From 3dc04a15cc48a27126b52e09321baa5535ca7fa9 Mon Sep 17 00:00:00 2001
From: Marvin Ramin <marvinramin@google.com>
Date: Wed, 16 Oct 2024 12:26:02 +0200
Subject: [PATCH] RESTRICT AUTOMERGE Use getLaunchedFromPackage instead of
 getCallingPackage

Ensure that MediaProjectionPermissionActivity is doing proper
attribution and validation of permissions before showing.

Bug: 372670004
Bug: 373581993
Test: presubmit
(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:3919d8df51f439d26de479374f2543594eb54382)
Merged-In: I48adb14fbc8d5f2f2e21ef8a30a713d33f03ab02
Change-Id: I48adb14fbc8d5f2f2e21ef8a30a713d33f03ab02
---
 .../systemui/media/MediaProjectionPermissionActivity.java     | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/media/MediaProjectionPermissionActivity.java b/packages/SystemUI/src/com/android/systemui/media/MediaProjectionPermissionActivity.java
index e2716e992c48..493cada4bab8 100644
--- a/packages/SystemUI/src/com/android/systemui/media/MediaProjectionPermissionActivity.java
+++ b/packages/SystemUI/src/com/android/systemui/media/MediaProjectionPermissionActivity.java
@@ -62,11 +62,11 @@ public class MediaProjectionPermissionActivity extends Activity
     public void onCreate(Bundle icicle) {
         super.onCreate(icicle);
 
-        mPackageName = getCallingPackage();
+        mPackageName = getLaunchedFromPackage();
         IBinder b = ServiceManager.getService(MEDIA_PROJECTION_SERVICE);
         mService = IMediaProjectionManager.Stub.asInterface(b);
 
-        if (mPackageName == null) {
+        if (getCallingPackage() == null) {
             finish();
             return;
         }
-- 
2.47.1.613.gc27f4b7a9f-goog

