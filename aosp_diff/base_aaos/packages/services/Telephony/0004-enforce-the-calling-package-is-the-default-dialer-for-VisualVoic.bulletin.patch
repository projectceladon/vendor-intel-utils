From 84870f61f174f2b28d037002439931e2ae494c3f Mon Sep 17 00:00:00 2001
From: Thomas Stuart <tjstuart@google.com>
Date: Thu, 6 Jun 2024 22:34:33 +0000
Subject: [PATCH] enforce the calling package is the default dialer for
 VisualVoicemail

In the docs for setVisualVoicemailSmsFilterSettings, they state that
the callingPackage needs to be the default dialer. However, server side,
there is no enforcement for this. Now, every client is verified to be
the default dialer, system dialer, or carrier visual voicemail app
before changing the settings for visual voicemail.

Bug: 308932906
Test: CTS
(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:ab8b7650f1ff3648f64ce3d9731c5ea1420310ee)
Merged-In: I951d7783f5c425c03768efb7aee7a38e299e6536
Change-Id: I951d7783f5c425c03768efb7aee7a38e299e6536
---
 src/com/android/phone/PhoneInterfaceManager.java | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/com/android/phone/PhoneInterfaceManager.java b/src/com/android/phone/PhoneInterfaceManager.java
index 388038b12..5763f11a7 100755
--- a/src/com/android/phone/PhoneInterfaceManager.java
+++ b/src/com/android/phone/PhoneInterfaceManager.java
@@ -3696,7 +3696,7 @@ public class PhoneInterfaceManager extends ITelephony.Stub {
     public void enableVisualVoicemailSmsFilter(String callingPackage, int subId,
             VisualVoicemailSmsFilterSettings settings) {
         mAppOps.checkPackage(Binder.getCallingUid(), callingPackage);
-
+        enforceVisualVoicemailPackage(callingPackage, subId);
         final long identity = Binder.clearCallingIdentity();
         try {
             VisualVoicemailSmsFilterConfig.enableVisualVoicemailSmsFilter(
@@ -3709,7 +3709,7 @@ public class PhoneInterfaceManager extends ITelephony.Stub {
     @Override
     public void disableVisualVoicemailSmsFilter(String callingPackage, int subId) {
         mAppOps.checkPackage(Binder.getCallingUid(), callingPackage);
-
+        enforceVisualVoicemailPackage(callingPackage, subId);
         final long identity = Binder.clearCallingIdentity();
         try {
             VisualVoicemailSmsFilterConfig.disableVisualVoicemailSmsFilter(
-- 
2.46.1.824.gd892dcdcdd-goog

