From e654ee64cfeff0c672af289410ddadc92f16c900 Mon Sep 17 00:00:00 2001
From: Austin Sun <austin.sun@intel.com>
Date: Wed, 1 Nov 2023 06:26:44 +0000
Subject: [PATCH] as MCU is not ready , use car service to trigger system sleep

Signed-off-by: Austin Sun <austin.sun@intel.com>
---
 .../src/com/android/car/power/CarPowerManagementService.java   | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/service/src/com/android/car/power/CarPowerManagementService.java b/service/src/com/android/car/power/CarPowerManagementService.java
index 9c26dc93d..093bdde8c 100644
--- a/service/src/com/android/car/power/CarPowerManagementService.java
+++ b/service/src/com/android/car/power/CarPowerManagementService.java
@@ -876,6 +876,7 @@ public class CarPowerManagementService extends ICarPower.Stub implements
         if (status != PolicyOperationStatus.OK) {
             Slogf.w(TAG, PolicyOperationStatus.errorCodeToString(status));
         }
+        Slogf.i(TAG, "doHandleDeepSleep");
         // keep holding partial wakelock to prevent entering sleep before enterDeepSleep call
         // enterDeepSleep should force sleep entry even if wake lock is kept.
         mSystemInterface.switchToPartialWakeLock();
@@ -1790,7 +1791,7 @@ public class CarPowerManagementService extends ICarPower.Stub implements
      */
     public void forceSuspendAndMaybeReboot(boolean shouldReboot) {
         synchronized (mSimulationWaitObject) {
-            mInSimulatedDeepSleepMode = true;
+            mInSimulatedDeepSleepMode = false;
             mWakeFromSimulatedSleep = false;
             mGarageModeShouldExitImmediately = false;
         }
-- 
2.17.1

