From d11fd5f49d41a7ad4311805dcb3b57556daee447 Mon Sep 17 00:00:00 2001
From: Adam Bookatz <bookatz@google.com>
Date: Mon, 18 Nov 2024 15:53:41 -0800
Subject: [PATCH] Don't let profiles open the UserSettings overflow [DO NOT
 MERGE]

Really, profiles aren't expected to open Settings at all. But if they
do somehow, the overflow shouldn't appear.

Bug: 352542820
Flag: EXEMPT bugfix
Test: Try to access the overflow of the work profile by launching its Settings in
adb shell am start --user 10 'com.android.settings/.Settings\$UserSettingsActivity'

(cherry picked from commit 69c7f5dac580361792bbb189178653b297d06c8a)
(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:fa5ff372a068f287d28e9294a461dd266d17bd16)
Merged-In: I5e4c095cda3e19fa5c63c2c550a526f5da8ec5c1
Change-Id: I5e4c095cda3e19fa5c63c2c550a526f5da8ec5c1
---
 src/com/android/settings/users/UserSettings.java | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/com/android/settings/users/UserSettings.java b/src/com/android/settings/users/UserSettings.java
index ee23fc379d..56bdfba306 100644
--- a/src/com/android/settings/users/UserSettings.java
+++ b/src/com/android/settings/users/UserSettings.java
@@ -358,8 +358,8 @@ public class UserSettings extends SettingsPreferenceFragment
         int pos = 0;
         // TODO(b/191509236): The menu item does not need to be accessible for guest users,
         //  regardless of mGuestUserAutoCreated
-        if (!mUserCaps.mIsAdmin && canSwitchUserNow() && !(isCurrentUserGuest()
-                && mGuestUserAutoCreated)) {
+        if (!mUserCaps.mIsAdmin && canSwitchUserNow() && !mUserManager.isProfile()
+                && !(isCurrentUserGuest() && mGuestUserAutoCreated)) {
             String nickname = mUserManager.getUserName();
             MenuItem removeThisUser = menu.add(0, MENU_REMOVE_USER, pos++,
                     getResources().getString(R.string.user_remove_user_menu, nickname));
-- 
2.47.1.613.gc27f4b7a9f-goog

