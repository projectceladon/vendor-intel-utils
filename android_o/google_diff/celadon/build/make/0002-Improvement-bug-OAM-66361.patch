From 8ab751658f797851f35ec57b3f334ecdeaafcfaf Mon Sep 17 00:00:00 2001
From: lab_aqa <lab_aqa@intel.com>
Date: Wed, 11 Jul 2018 09:53:12 +0530
Subject: [PATCH 2/4] Improvement bug  OAM-66361

Change-Id: I394da44b883902c2a09c7c4ad06a93c88602d05b
Tracked-On:https://jira01.devtools.intel.com/browse/OAM-66361
Signed-off-by: Priyanka Bose <priyanka.bose@intel.com>
---
 core/product_config.mk | 6 ++++++
 core/soong_config.mk   | 2 ++
 2 files changed, 8 insertions(+)

diff --git a/core/product_config.mk b/core/product_config.mk
index f7ae834..ebd9dba 100644
--- a/core/product_config.mk
+++ b/core/product_config.mk
@@ -433,6 +433,12 @@ PRODUCT_ART_TARGET_INCLUDE_DEBUG_BUILD := \
 PRODUCT_ART_USE_READ_BARRIER := \
     $(strip $(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_ART_USE_READ_BARRIER))
 
+# Make this art vendor variable visible to soong_config.mk.
+CAPSTONE_EXT_LIBRARY := $(strip $(ANDROID_BUILD_TOP)/vendor/intel/external/capstone/Android.bp)
+ifneq ("$(wildcard$(CAPSTONE_EXT_LIBRARY))", ) 
+  ART_CAPSTONE_INCLUDES := true
+endif
+
 # Whether the product is an Android Things variant.
 PRODUCT_IOT := \
     $(strip $(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_IOT))
diff --git a/core/soong_config.mk b/core/soong_config.mk
index cdd2896..468b676 100644
--- a/core/soong_config.mk
+++ b/core/soong_config.mk
@@ -87,6 +87,8 @@ $(SOONG_VARIABLES): FORCE
 	echo ''; \
 	echo '    "ArtUseReadBarrier": $(if $(filter false,$(PRODUCT_ART_USE_READ_BARRIER)),false,true),'; \
 	echo ''; \
+	echo '    "AutoFastJni": $(if $(filter true,$(ART_CAPSTONE_INCLUDES)),true,false),'; \
+	echo ''; \
 	echo '    "BtConfigIncludeDir": "$(BOARD_BLUETOOTH_BDROID_BUILDCFG_INCLUDE_DIR)",'; \
 	echo ''; \
 	echo '    "DeviceKernelHeaders": $(call json_list,$(strip $(TARGET_PROJECT_SYSTEM_INCLUDES)))'; \
-- 
1.9.1

