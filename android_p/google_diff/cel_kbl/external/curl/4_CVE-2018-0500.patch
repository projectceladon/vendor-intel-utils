From 4f7d318945a7d60fe5f14d4f1a658ef8e9e5e7ce Mon Sep 17 00:00:00 2001
From: zhongjie <zhongjie.shi@intel.com>
Date: Thu, 14 Feb 2019 18:41:53 +0800
Subject: [PATCH] CVE-2018-0500 fix

Reference https://github.com/curl/curl/commit/ba1dbd78e5f1e.patch

Change-Id: Ifcd2cf996f10db277e9e145a104bf88f082df62a
Tracked-On:
Signed-off-by: zhongjie <zhongjie.shi@intel.com>
---

diff --git a/lib/smtp.c b/lib/smtp.c
index d9f1a85..ecf8c99 100644
--- a/lib/smtp.c
+++ b/lib/smtp.c
@@ -1558,13 +1558,14 @@
   if(!scratch || data->set.crlf) {
     oldscratch = scratch;
 
-    scratch = newscratch = malloc(2 * data->set.buffer_size);
+    scratch = newscratch = malloc(2 * UPLOAD_BUFSIZE);
     if(!newscratch) {
       failf(data, "Failed to alloc scratch buffer!");
 
       return CURLE_OUT_OF_MEMORY;
     }
   }
+  DEBUGASSERT(UPLOAD_BUFSIZE >= nread);
 
   /* Have we already sent part of the EOB? */
   eob_sent = smtp->eob;
