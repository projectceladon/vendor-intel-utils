From 9a4b19b256ef9807995c76607e6c35092cd0573d Mon Sep 17 00:00:00 2001
From: "Wang, ArvinX" <arvinx.wang@intel.com>
Date: Thu, 20 Jun 2019 11:31:41 +0800
Subject: [PATCH] Fix CarSetting crash while checking passwork

Change-Id: If5bba110be53c60a3e0dd7364c89390c6d62e0d5
Tracked-On: https://jira.devtools.intel.com/browse/OAM-
Signed-off-by: Wang, ArvinX <arvinx.wang@intel.com>
---
 .../security/ConfirmLockPinPasswordFragment.java         | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/com/android/car/settings/security/ConfirmLockPinPasswordFragment.java b/src/com/android/car/settings/security/ConfirmLockPinPasswordFragment.java
index 0ce0ec9..13403d8 100644
--- a/src/com/android/car/settings/security/ConfirmLockPinPasswordFragment.java
+++ b/src/com/android/car/settings/security/ConfirmLockPinPasswordFragment.java
@@ -183,6 +183,10 @@ public class ConfirmLockPinPasswordFragment extends BaseFragment {
 
     private void initPasswordView() {
         mPasswordField.setOnEditorActionListener((textView, actionId, keyEvent) -> {
+            mEnteredPassword = mPasswordField.getText().toString();
+            if (TextUtils.isEmpty(mEnteredPassword)) {
+                return false;
+            }
             // Check if this was the result of hitting the enter or "done" key.
             if (actionId == EditorInfo.IME_NULL
                     || actionId == EditorInfo.IME_ACTION_DONE
@@ -190,7 +194,6 @@ public class ConfirmLockPinPasswordFragment extends BaseFragment {
 
                 initCheckLockWorker();
                 if (!mCheckLockWorker.isCheckInProgress()) {
-                    mEnteredPassword = mPasswordField.getText().toString();
                     mCheckLockWorker.checkPinPassword(mUserId, mEnteredPassword);
                 }
                 return true;
@@ -240,7 +243,9 @@ public class ConfirmLockPinPasswordFragment extends BaseFragment {
         } else {
             mMsgView.setText(
                     mIsPin ? R.string.lockscreen_wrong_pin : R.string.lockscreen_wrong_password);
-            mPinPad.setEnabled(true);
+            if (mIsPin) {
+                mPinPad.setEnabled(true);
+            }
         }
 
         if (!mIsPin) {
-- 
2.21.0

