From 1d6551d1e400f08e200ff71a159eefead263522f Mon Sep 17 00:00:00 2001
From: "Zhang, Qi" <qi1.zhang@intel.com>
Date: Fri, 16 Nov 2018 08:54:35 +0800
Subject: [PATCH] print trusty seed read from TPM

Signed-off-by: Zhang, Qi <qi1.zhang@intel.com>
---
 libkernelflinger/security_efi.c  | 2 +-
 libkernelflinger/tpm2_security.c | 9 +++++++++
 2 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/libkernelflinger/security_efi.c b/libkernelflinger/security_efi.c
index a1be3f5..ef97dc2 100755
--- a/libkernelflinger/security_efi.c
+++ b/libkernelflinger/security_efi.c
@@ -135,7 +135,7 @@ EFI_STATUS get_seeds(IN UINT32 *num_seeds, OUT VOID *seed_list)
 			efi_perror(ret, L"Failed to read trusty seed from TPM");
 			return ret;
 		}
-		debug(L"Success read seed from TPM");
+		debug(L">>>> Success read seed from TPM <<<<<");
 		*num_seeds = 1;
 		tmp = (seed_info_t *)seed_list;
 		tmp->svn = BOOTLOADER_SEED_MAX_ENTRIES - 1;
diff --git a/libkernelflinger/tpm2_security.c b/libkernelflinger/tpm2_security.c
index 343170c..887b747 100644
--- a/libkernelflinger/tpm2_security.c
+++ b/libkernelflinger/tpm2_security.c
@@ -564,6 +564,12 @@ static void dump_data(
 		SPrint(buf + i * 2, sizeof(buf) - i * 2, L"%02x", data[i]);
 	debug(L"Data: %s", buf);
 #endif
+	UINT16 i;
+
+	Print(L"Trusty seed:\n");
+	for(i=0; i < data_size; i++)
+		Print(L"0x%x ", data[i]);
+	Print(L"\n");
 }
 
 EFI_STATUS tpm2_fuse_trusty_seed(void)
@@ -634,6 +640,9 @@ EFI_STATUS tpm2_read_trusty_seed(UINT8 seed[TRUSTY_SEED_SIZE])
 		ret = EFI_COMPROMISED_DATA;
 		goto out;
 	}
+	Print(L">>>> Success to read trusty seed from TPM<<<<\n");
+	debug(L"trusty seed:");
+
 	dump_data(seed, TRUSTY_SEED_SIZE);
 	return EFI_SUCCESS;
 
-- 
2.20.1

