From d8599855245c6ce2013d28e2c5017437743e0bf6 Mon Sep 17 00:00:00 2001
From: varun <varunx.jeevangoudar@intel.com>
Date: Mon, 18 Feb 2019 16:50:59 +0530
Subject: [PATCH] Avoids going to blank screen after max users.

Change-Id: I0428a90c570c93ada011ff2416b5e0e8ab56f752
Tracked-On: OAM-76010
Signed-off-by: varun <varunx.jeevangoudar@intel.com>
---
 .../statusbar/car/UserGridRecyclerView.java        | 24 +++++++++++++++-------
 1 file changed, 17 insertions(+), 7 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/car/UserGridRecyclerView.java b/packages/SystemUI/src/com/android/systemui/statusbar/car/UserGridRecyclerView.java
index 4a70bc8..d9c3521 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/car/UserGridRecyclerView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/car/UserGridRecyclerView.java
@@ -48,6 +48,7 @@ import com.android.systemui.R;
 import com.android.systemui.statusbar.phone.SystemUIDialog;
 import java.util.ArrayList;
 import java.util.List;
+import android.os.UserManager;
 
 /**
  * Displays a GridLayout with icons for the users in the system to allow switching between users.
@@ -55,19 +56,20 @@ import java.util.List;
  */
 public class UserGridRecyclerView extends PagedListView implements
         UserManagerHelper.OnUsersUpdateListener {
+    int current_users;
+    int users_get_max;
     private UserSelectionListener mUserSelectionListener;
     private UserAdapter mAdapter;
     private UserManagerHelper mUserManagerHelper;
     private Context mContext;
-
+    private static final String TAG = "UserGridRecyclerView";
     public UserGridRecyclerView(Context context, AttributeSet attrs) {
         super(context, attrs);
         mContext = context;
         mUserManagerHelper = new UserManagerHelper(mContext);
     }
-
     /**
-     * Register listener for any update to the users
+/     * Register listener for any update to the users
      */
     @Override
     public void onFinishInflate() {
@@ -83,8 +85,7 @@ public class UserGridRecyclerView extends PagedListView implements
         super.onDetachedFromWindow();
         mUserManagerHelper.unregisterOnUsersUpdateListener();
     }
-
-    /**
+     /**
      * Initializes the adapter that populates the grid layout
      *
      * @return the adapter
@@ -114,7 +115,6 @@ public class UserGridRecyclerView extends PagedListView implements
         if (mUserManagerHelper.getForegroundUserInfo().isAdmin()) {
             userRecords.add(addGuestUserRecord());
         }
-
         // Add add user record if the foreground user can add users
         if (mUserManagerHelper.foregroundUserCanAddUsers()) {
             userRecords.add(addUserRecord());
@@ -195,8 +195,10 @@ public class UserGridRecyclerView extends PagedListView implements
             view.setAlpha(1f);
             view.bringToFront();
             return new UserAdapterViewHolder(view);
+
         }
 
+
         @Override
         public void onBindViewHolder(UserAdapterViewHolder holder, int position) {
             UserRecord userRecord = mUsers.get(position);
@@ -205,7 +207,15 @@ public class UserGridRecyclerView extends PagedListView implements
             circleIcon.setCircular(true);
             holder.mUserAvatarImageView.setImageDrawable(circleIcon);
             holder.mUserNameTextView.setText(userRecord.mInfo.name);
-
+	    holder.mView.setEnabled(true);   
+       	    if (userRecord.mIsAddUser) { 
+       		mAddUserView = holder.mView;
+	     	users_get_max =  UserManager.getMaxSupportedUsers();
+	        current_users = mUserManagerHelper.getAllUsers().size();
+	            if (current_users >= users_get_max){
+                	mAddUserView.setEnabled(false);
+            	    }
+            }
             holder.mView.setOnClickListener(v -> {
                 if (userRecord == null) {
                     return;
-- 
1.9.1

