From 8c5dcce6cdd43bb488968ebd6efedffe2c264c66 Mon Sep 17 00:00:00 2001
From: Erik de Castro Lopo <erikd@mega-nerd.com>
Date: Sat, 08 Apr 2017 18:34:49 +1000
Subject: [PATCH] stream_decoder.c: Fix a memory leak

Leak reported by Secunia Research.

Change-Id: Ic674349f89d68564c55532e5150b83d1ffd1ccef
Signed-off-by: Bing Deng <bing.deng@intel.com>
---

diff --git a/libFLAC/stream_decoder.c b/libFLAC/stream_decoder.c
index d364b0c..8770620 100644
--- a/libFLAC/stream_decoder.c
+++ b/libFLAC/stream_decoder.c
@@ -1759,6 +1759,9 @@
 					}
 					memset (obj->comments[i].entry, 0, obj->comments[i].length) ;
 					if (!FLAC__bitreader_read_byte_block_aligned_no_crc(decoder->private_->input, obj->comments[i].entry, obj->comments[i].length)) {
+						/* Current i-th entry is bad, so we delete it. */
+						free (obj->comments[i].entry) ;
+						obj->comments[i].entry = NULL ;
 						obj->num_comments = i;
 						goto skip;
 					}
