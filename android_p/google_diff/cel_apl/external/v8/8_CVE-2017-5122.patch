From bf4d8b4b7aea19a128d48bc49b45d4c04a14e0c2 Mon Sep 17 00:00:00 2001
From: zhongjie <zhongjie.shi@intel.com>
Date: Thu, 14 Feb 2019 20:04:04 +0800
Subject: [PATCH] CVE-2017-5122 fix

Reference https://chromium.googlesource.com/v8/v8.git/+/7b903102e648a80a467150d48d1dc408672b3558

Change-Id: I1d1b5b0de109fd41ce503995e8129983186c0623
Tracked-On:
Signed-off-by: zhongjie <zhongjie.shi@intel.com>
---

diff --git a/src/assembler.cc b/src/assembler.cc
index d945cc4..e14ae71 100644
--- a/src/assembler.cc
+++ b/src/assembler.cc
@@ -350,10 +350,7 @@
 void RelocInfo::update_wasm_function_table_size_reference(
     uint32_t old_size, uint32_t new_size, ICacheFlushMode icache_flush_mode) {
   DCHECK(IsWasmFunctionTableSizeReference(rmode_));
-  uint32_t current_size_reference = wasm_function_table_size_reference();
-  uint32_t updated_size_reference =
-      new_size + (current_size_reference - old_size);
-  unchecked_update_wasm_size(updated_size_reference, icache_flush_mode);
+  unchecked_update_wasm_size(new_size, icache_flush_mode);
   if (icache_flush_mode != SKIP_ICACHE_FLUSH) {
     Assembler::FlushICache(isolate_, pc_, sizeof(int64_t));
   }
