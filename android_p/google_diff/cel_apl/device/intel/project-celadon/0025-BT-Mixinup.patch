From d081be86b1fcda54083210f28ee80aeb1369a05f Mon Sep 17 00:00:00 2001
From: swaroopb <swaroop.balan@intel.com>
Date: Mon, 4 Feb 2019 08:47:09 +0530
Subject: [PATCH] BT Mixinup

Tracked-On:
---
 cel_apl/BoardConfig.mk |  2 +-
 cel_apl/device.mk      |  7 ++++---
 cel_apl/init.rc        | 11 +++--------
 cel_kbl/BoardConfig.mk |  2 +-
 cel_kbl/device.mk      |  7 ++++---
 cel_kbl/init.rc        | 13 ++++---------
 celadon/BoardConfig.mk |  2 +-
 celadon/device.mk      |  5 +++--
 celadon/init.rc        | 13 ++++---------
 9 files changed, 25 insertions(+), 37 deletions(-)

diff --git a/cel_apl/BoardConfig.mk b/cel_apl/BoardConfig.mk
index fbb5e94..5009052 100644
--- a/cel_apl/BoardConfig.mk
+++ b/cel_apl/BoardConfig.mk
@@ -120,7 +120,7 @@ BOARD_SEPOLICY_DIRS += device/intel/project-celadon/sepolicy/kernel
 ##############################################################
 # Source: device/intel/mixins/groups/bluetooth/btusb/BoardConfig.mk
 ##############################################################
-BOARD_HAVE_BLUETOOTH_LINUX_PRI := true
+BOARD_HAVE_BLUETOOTH_INTEL_ICNV := true
 DEVICE_PACKAGE_OVERLAYS += device/intel/common/bluetooth/overlay-bt-pan
 BOARD_SEPOLICY_DIRS += device/intel/project-celadon/sepolicy/bluetooth/common
 
diff --git a/cel_apl/device.mk b/cel_apl/device.mk
index a077432..a77df21 100644
--- a/cel_apl/device.mk
+++ b/cel_apl/device.mk
@@ -368,7 +368,7 @@ PRODUCT_PACKAGES += \
   android.hardware.bluetooth@1.0-service.vbt \
   libbt-vendor
 
-PRODUCT_PACKAGE_OVERLAYS += $(INTEL_PATH_COMMON)/bluetooth/overlay-car
+PRODUCT_PACKAGE_OVERLAYS += $(INTEL_PATH_COMMON)/bluetooth/overlay-car-disablehfp
 
 ##############################################################
 # Source: device/intel/mixins/groups/disk-bus/auto/product.mk
@@ -487,7 +487,7 @@ PRODUCT_PROPERTY_OVERRIDES += audio.safemedia.bypass=true
 PRODUCT_PACKAGES += \
     hostapd \
     hostapd_cli \
-	wificond \
+    wificond \
     wifilogd \
     wpa_supplicant \
     wpa_cli \
@@ -505,7 +505,8 @@ PRODUCT_PACKAGES += \
 #copy iwlwifi wpa config files
 PRODUCT_COPY_FILES += \
         device/intel/common/wlan/wpa_supplicant-common.conf:vendor/etc/wifi/wpa_supplicant.conf \
-        device/intel/common/wlan/iwlwifi/wpa_supplicant_overlay_no_tdls.conf:vendor/etc/wifi/wpa_supplicant_overlay.conf \
+        device/intel/common/wlan/iwlwifi/wpa_supplicant_overlay.conf:vendor/etc/wifi/wpa_supplicant_overlay.conf \
+        device/intel/common/wlan/iwlwifi/p2p_supplicant_overlay.conf:vendor/etc/wifi/p2p_supplicant_overlay.conf \
         frameworks/native/data/etc/android.hardware.wifi.xml:vendor/etc/permissions/android.hardware.wifi.xml
 
 
diff --git a/cel_apl/init.rc b/cel_apl/init.rc
index b85c3a3..beb5403 100644
--- a/cel_apl/init.rc
+++ b/cel_apl/init.rc
@@ -455,11 +455,6 @@ on property:sys.boot_completed=1
 ##############################################################
 # Source: device/intel/mixins/groups/bluetooth/btusb/init.rc
 ##############################################################
-on post-fs-data
-    # To store BT paired info
-    mkdir /data/misc/hcid 0770 bluetooth bluetooth
-    setprop persist.bluetooth.enablenewavrcp false
-
 on boot
     chmod 0644 /sys/kernel/debug/bluetooth/l2cap_le_max_credits
     chmod 0644 /sys/kernel/debug/bluetooth/l2cap_le_default_mps
@@ -516,9 +511,9 @@ on boot
 # Source: device/intel/mixins/groups/wlan/iwlwifi/init.rc
 ##############################################################
 on post-fs-data
-    chmod 0660 /data/misc/wifi/p2p_supplicant.conf
-	setprop wifi.interface wlan0
-	setprop wifi.direct.interface p2p0
+    setprop wifi.interface wlan0
+    setprop wifi.direct.interface p2p-dev-wlan0
+
     # create config WiFi NVM folder
     mkdir /oem_config/wlan 0770 wifi system
 
diff --git a/cel_kbl/BoardConfig.mk b/cel_kbl/BoardConfig.mk
index bc3f723..ff8e024 100644
--- a/cel_kbl/BoardConfig.mk
+++ b/cel_kbl/BoardConfig.mk
@@ -120,7 +120,7 @@ BOARD_SEPOLICY_DIRS += device/intel/project-celadon/sepolicy/kernel
 ##############################################################
 # Source: device/intel/mixins/groups/bluetooth/btusb/BoardConfig.mk
 ##############################################################
-BOARD_HAVE_BLUETOOTH_LINUX_PRI := true
+BOARD_HAVE_BLUETOOTH_INTEL_ICNV := true
 DEVICE_PACKAGE_OVERLAYS += device/intel/common/bluetooth/overlay-bt-pan
 BOARD_SEPOLICY_DIRS += device/intel/project-celadon/sepolicy/bluetooth/common
 
diff --git a/cel_kbl/device.mk b/cel_kbl/device.mk
index a077432..a77df21 100644
--- a/cel_kbl/device.mk
+++ b/cel_kbl/device.mk
@@ -368,7 +368,7 @@ PRODUCT_PACKAGES += \
   android.hardware.bluetooth@1.0-service.vbt \
   libbt-vendor
 
-PRODUCT_PACKAGE_OVERLAYS += $(INTEL_PATH_COMMON)/bluetooth/overlay-car
+PRODUCT_PACKAGE_OVERLAYS += $(INTEL_PATH_COMMON)/bluetooth/overlay-car-disablehfp
 
 ##############################################################
 # Source: device/intel/mixins/groups/disk-bus/auto/product.mk
@@ -487,7 +487,7 @@ PRODUCT_PROPERTY_OVERRIDES += audio.safemedia.bypass=true
 PRODUCT_PACKAGES += \
     hostapd \
     hostapd_cli \
-	wificond \
+    wificond \
     wifilogd \
     wpa_supplicant \
     wpa_cli \
@@ -505,7 +505,8 @@ PRODUCT_PACKAGES += \
 #copy iwlwifi wpa config files
 PRODUCT_COPY_FILES += \
         device/intel/common/wlan/wpa_supplicant-common.conf:vendor/etc/wifi/wpa_supplicant.conf \
-        device/intel/common/wlan/iwlwifi/wpa_supplicant_overlay_no_tdls.conf:vendor/etc/wifi/wpa_supplicant_overlay.conf \
+        device/intel/common/wlan/iwlwifi/wpa_supplicant_overlay.conf:vendor/etc/wifi/wpa_supplicant_overlay.conf \
+        device/intel/common/wlan/iwlwifi/p2p_supplicant_overlay.conf:vendor/etc/wifi/p2p_supplicant_overlay.conf \
         frameworks/native/data/etc/android.hardware.wifi.xml:vendor/etc/permissions/android.hardware.wifi.xml
 
 
diff --git a/cel_kbl/init.rc b/cel_kbl/init.rc
index 78d4dd9..beb5403 100644
--- a/cel_kbl/init.rc
+++ b/cel_kbl/init.rc
@@ -455,11 +455,6 @@ on property:sys.boot_completed=1
 ##############################################################
 # Source: device/intel/mixins/groups/bluetooth/btusb/init.rc
 ##############################################################
-on post-fs-data
-    # To store BT paired info
-    mkdir /data/misc/hcid 0770 bluetooth bluetooth
-    setprop persist.bluetooth.enablenewavrcp false
-
 on boot
     chmod 0644 /sys/kernel/debug/bluetooth/l2cap_le_max_credits
     chmod 0644 /sys/kernel/debug/bluetooth/l2cap_le_default_mps
@@ -509,16 +504,16 @@ on post-fs
 ##############################################################
 # Source: device/intel/mixins/groups/audio/project-celadon/init.rc
 ##############################################################
-on post-fs
+on boot
     insmod /vendor/lib/modules/kernel/sound/drivers/snd-dummy.ko
 
 ##############################################################
 # Source: device/intel/mixins/groups/wlan/iwlwifi/init.rc
 ##############################################################
 on post-fs-data
-    chmod 0660 /data/misc/wifi/p2p_supplicant.conf
-	setprop wifi.interface wlan0
-	setprop wifi.direct.interface p2p0
+    setprop wifi.interface wlan0
+    setprop wifi.direct.interface p2p-dev-wlan0
+
     # create config WiFi NVM folder
     mkdir /oem_config/wlan 0770 wifi system
 
diff --git a/celadon/BoardConfig.mk b/celadon/BoardConfig.mk
index 7ff8339..49c32ee 100644
--- a/celadon/BoardConfig.mk
+++ b/celadon/BoardConfig.mk
@@ -124,7 +124,7 @@ BOARD_SEPOLICY_DIRS += device/intel/project-celadon/sepolicy/kernel
 ##############################################################
 # Source: device/intel/mixins/groups/bluetooth/btusb/BoardConfig.mk
 ##############################################################
-BOARD_HAVE_BLUETOOTH_LINUX_PRI := true
+BOARD_HAVE_BLUETOOTH_INTEL_ICNV := true
 DEVICE_PACKAGE_OVERLAYS += device/intel/common/bluetooth/overlay-bt-pan
 BOARD_SEPOLICY_DIRS += device/intel/project-celadon/sepolicy/bluetooth/common
 
diff --git a/celadon/device.mk b/celadon/device.mk
index 560c3d0..5ca72bb 100644
--- a/celadon/device.mk
+++ b/celadon/device.mk
@@ -483,7 +483,7 @@ PRODUCT_PROPERTY_OVERRIDES += audio.safemedia.bypass=true
 PRODUCT_PACKAGES += \
     hostapd \
     hostapd_cli \
-	wificond \
+    wificond \
     wifilogd \
     wpa_supplicant \
     wpa_cli \
@@ -501,7 +501,8 @@ PRODUCT_PACKAGES += \
 #copy iwlwifi wpa config files
 PRODUCT_COPY_FILES += \
         device/intel/common/wlan/wpa_supplicant-common.conf:vendor/etc/wifi/wpa_supplicant.conf \
-        device/intel/common/wlan/iwlwifi/wpa_supplicant_overlay_no_tdls.conf:vendor/etc/wifi/wpa_supplicant_overlay.conf \
+        device/intel/common/wlan/iwlwifi/wpa_supplicant_overlay.conf:vendor/etc/wifi/wpa_supplicant_overlay.conf \
+        device/intel/common/wlan/iwlwifi/p2p_supplicant_overlay.conf:vendor/etc/wifi/p2p_supplicant_overlay.conf \
         frameworks/native/data/etc/android.hardware.wifi.xml:vendor/etc/permissions/android.hardware.wifi.xml
 
 
diff --git a/celadon/init.rc b/celadon/init.rc
index 78d4dd9..beb5403 100644
--- a/celadon/init.rc
+++ b/celadon/init.rc
@@ -455,11 +455,6 @@ on property:sys.boot_completed=1
 ##############################################################
 # Source: device/intel/mixins/groups/bluetooth/btusb/init.rc
 ##############################################################
-on post-fs-data
-    # To store BT paired info
-    mkdir /data/misc/hcid 0770 bluetooth bluetooth
-    setprop persist.bluetooth.enablenewavrcp false
-
 on boot
     chmod 0644 /sys/kernel/debug/bluetooth/l2cap_le_max_credits
     chmod 0644 /sys/kernel/debug/bluetooth/l2cap_le_default_mps
@@ -509,16 +504,16 @@ on post-fs
 ##############################################################
 # Source: device/intel/mixins/groups/audio/project-celadon/init.rc
 ##############################################################
-on post-fs
+on boot
     insmod /vendor/lib/modules/kernel/sound/drivers/snd-dummy.ko
 
 ##############################################################
 # Source: device/intel/mixins/groups/wlan/iwlwifi/init.rc
 ##############################################################
 on post-fs-data
-    chmod 0660 /data/misc/wifi/p2p_supplicant.conf
-	setprop wifi.interface wlan0
-	setprop wifi.direct.interface p2p0
+    setprop wifi.interface wlan0
+    setprop wifi.direct.interface p2p-dev-wlan0
+
     # create config WiFi NVM folder
     mkdir /oem_config/wlan 0770 wifi system
 
-- 
2.20.1

