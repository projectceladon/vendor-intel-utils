From a86cea59c0c910e047274c740375847699cf9f11 Mon Sep 17 00:00:00 2001
From: Aiswarya Cyriac <aiswarya.cyriac@intel.com>
Date: Thu, 7 Mar 2019 15:29:20 +0530
Subject: [PATCH] Sepolicy for BT virtual driver and make sepolicy permissive

Tracked-On:
Signed-off-by: Aiswarya Cyriac <aiswarya.cyriac@intel.com>
---
 cel_apl/mixins.spec                    | 2 +-
 cel_kbl/mixins.spec                    | 2 +-
 kernel_config/kernel_64_defconfig      | 1 +
 sepolicy/bluetooth/common/bluetooth.te | 4 ++++
 4 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/cel_apl/mixins.spec b/cel_apl/mixins.spec
index 7d604e9..f030544 100644
--- a/cel_apl/mixins.spec
+++ b/cel_apl/mixins.spec
@@ -10,7 +10,7 @@ treble: true
 vndk: true
 2ndstage: oemvars
 project-celadon: default
-sepolicy: enforcing
+sepolicy: permissive
 graphics: mesa(gralloc1=true,gen9+=true,hwc2=true,vulkan=true,drmhwc=false,minigbm=true)
 media: project-celadon(mediasdk=false,media_sdk_source=false)
 ethernet: dhcp
diff --git a/cel_kbl/mixins.spec b/cel_kbl/mixins.spec
index 7484cfa..1cc60da 100644
--- a/cel_kbl/mixins.spec
+++ b/cel_kbl/mixins.spec
@@ -10,7 +10,7 @@ treble: true
 vndk: true
 2ndstage: oemvars
 project-celadon: default
-sepolicy: enforcing
+sepolicy: permissive
 graphics: mesa(gralloc1=true,gen9+=true,hwc2=true,vulkan=true,drmhwc=false,minigbm=true)
 media: project-celadon(mediasdk=false,media_sdk_source=false)
 ethernet: dhcp
diff --git a/kernel_config/kernel_64_defconfig b/kernel_config/kernel_64_defconfig
index bcd7af3..774a0c0 100644
--- a/kernel_config/kernel_64_defconfig
+++ b/kernel_config/kernel_64_defconfig
@@ -1554,6 +1554,7 @@ CONFIG_NVME_TARGET=y
 CONFIG_MISC_RTSX=y
 CONFIG_UID_SYS_STATS=y
 # CONFIG_UID_SYS_STATS_DEBUG is not set
+CONFIG_BT_SCOHCI=y
 # CONFIG_C2PORT is not set
 
 #
diff --git a/sepolicy/bluetooth/common/bluetooth.te b/sepolicy/bluetooth/common/bluetooth.te
index b45785a..9a6877e 100644
--- a/sepolicy/bluetooth/common/bluetooth.te
+++ b/sepolicy/bluetooth/common/bluetooth.te
@@ -20,3 +20,7 @@ allow bluetooth bluetooth_efs_file:file create_file_perms;
 
 allow bluetooth bluetooth_config_file:dir r_dir_perms;
 allow bluetooth bluetooth_config_file:file r_file_perms;
+
+allow bluetooth device:chr_file { ioctl open write };
+allow bluetooth audio_device:dir search;
+
-- 
2.17.1

