From a52e748ff9590853589910be6f1ee151bdc27542 Mon Sep 17 00:00:00 2001
From: renchenglei <chenglei.ren@intel.com>
Date: Mon, 27 Apr 2020 07:24:03 +0800
Subject: [PATCH] [DO NOT MERGE]One tmp fix for eMMC boot issue on 8th APL NUC

Tracked-On:
---
 celadon/BoardConfig.mk |  4 ----
 celadon/device.mk      |  8 --------
 celadon/init.rc        | 10 ++++++----
 3 files changed, 6 insertions(+), 16 deletions(-)

diff --git a/celadon/BoardConfig.mk b/celadon/BoardConfig.mk
index f3936f31a913..9b4cabcb6379 100644
--- a/celadon/BoardConfig.mk
+++ b/celadon/BoardConfig.mk
@@ -482,10 +482,6 @@ TARGET_ARCH := x86
 TARGET_CPU_ABI := x86
 endif
 ##############################################################
-# Source: device/intel/mixins/groups/cpuset/autocores/BoardConfig.mk
-##############################################################
-BOARD_SEPOLICY_DIRS += $(INTEL_PATH_SEPOLICY)/config_cpuset
-##############################################################
 # Source: device/intel/mixins/groups/rfkill/true/BoardConfig.mk
 ##############################################################
 BOARD_SEPOLICY_DIRS += $(INTEL_PATH_SEPOLICY)/rfkill
diff --git a/celadon/device.mk b/celadon/device.mk
index 10565594f06d..4544faa19bbf 100644
--- a/celadon/device.mk
+++ b/celadon/device.mk
@@ -580,14 +580,6 @@ PRODUCT_DEFAULT_PROPERTY_OVERRIDES += \
 PRODUCT_PACKAGES += \
   android.hardware.wifi@1.0-service
 ##############################################################
-# Source: device/intel/mixins/groups/cpuset/autocores/product.mk
-##############################################################
-PRODUCT_PACKAGES += \
-    config_cpuset.sh
-
-PRODUCT_COPY_FILES += \
-    $(LOCAL_PATH)/extra_files/cpuset/config_cpuset.sh:vendor/bin/config_cpuset.sh
-##############################################################
 # Source: device/intel/mixins/groups/rfkill/true/product.mk
 ##############################################################
 PRODUCT_COPY_FILES += $(INTEL_PATH_COMMON)/rfkill/rfkill-init.sh:vendor/bin/rfkill-init.sh
diff --git a/celadon/init.rc b/celadon/init.rc
index 529395dc9146..9c3b1a10d1c3 100644
--- a/celadon/init.rc
+++ b/celadon/init.rc
@@ -655,10 +655,12 @@ on boot
 ##############################################################
 # Source: device/intel/mixins/groups/cpuset/autocores/init.rc
 ##############################################################
-on early-boot
-    # execute script to set initial CPU settings
-    # don't run as a service to avoid race conditions
-    exec - root system -- /vendor/bin/config_cpuset.sh
+on late-init
+    copy /sys/devices/system/cpu/online /dev/cpuset/foreground/cpus
+    copy /sys/devices/system/cpu/online /dev/cpuset/background/cpus
+    copy /sys/devices/system/cpu/online /dev/cpuset/system-background/cpus
+    copy /sys/devices/system/cpu/online /dev/cpuset/top-app/cpus
+    copy /sys/devices/system/cpu/online /dev/cpuset/foreground/boost/cpus
 ##############################################################
 # Source: device/intel/mixins/groups/rfkill/true/init.rc
 ##############################################################
-- 
2.17.1

