From 53a88a5fca0c69bc3968b86983d7e5113f25c302 Mon Sep 17 00:00:00 2001
From: "Yan, Shaopu" <shaopu.yan@intel.com>
Date: Tue, 14 Jul 2020 10:47:05 +0800
Subject: [PATCH] Fix neverallow issue of cickeymasterd

Change-Id: I17da1ff9ba66c7f1ea16602f4719d02b521e1f06
Tracked-On:
Signed-off-by: Yan, Shaopu <shaopu.yan@intel.com>
---
 prebuilts/api/28.0/public/domain.te          | 2 +-
 prebuilts/api/28.0/public/hal_neverallows.te | 1 +
 public/domain.te                             | 2 +-
 public/hal_neverallows.te                    | 1 +
 4 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/prebuilts/api/28.0/public/domain.te b/prebuilts/api/28.0/public/domain.te
index e9337b654..30efba56b 100644
--- a/prebuilts/api/28.0/public/domain.te
+++ b/prebuilts/api/28.0/public/domain.te
@@ -1363,7 +1363,7 @@ neverallow {
   -vold_prepare_subdirs
   -zygote
 } self:capability dac_override;
-neverallow { domain -traced_probes } self:capability dac_read_search;
+neverallow { domain -traced_probes -vold } self:capability dac_read_search;
 
 # If an already existing file is opened with O_CREAT, the kernel might generate
 # a false report of a create denial. Silence these denials and make sure that
diff --git a/prebuilts/api/28.0/public/hal_neverallows.te b/prebuilts/api/28.0/public/hal_neverallows.te
index 0f05d8ad3..8b8e80deb 100644
--- a/prebuilts/api/28.0/public/hal_neverallows.te
+++ b/prebuilts/api/28.0/public/hal_neverallows.te
@@ -23,6 +23,7 @@ neverallow {
   -hal_wifi_hostapd_server
   -hal_wifi_supplicant_server
   -hal_telephony_server
+  -hal_keymaster_server
 } domain:{ tcp_socket udp_socket rawip_socket } *;
 
 ###
diff --git a/public/domain.te b/public/domain.te
index e9337b654..30efba56b 100644
--- a/public/domain.te
+++ b/public/domain.te
@@ -1363,7 +1363,7 @@ neverallow {
   -vold_prepare_subdirs
   -zygote
 } self:capability dac_override;
-neverallow { domain -traced_probes } self:capability dac_read_search;
+neverallow { domain -traced_probes -vold } self:capability dac_read_search;
 
 # If an already existing file is opened with O_CREAT, the kernel might generate
 # a false report of a create denial. Silence these denials and make sure that
diff --git a/public/hal_neverallows.te b/public/hal_neverallows.te
index 0f05d8ad3..8b8e80deb 100644
--- a/public/hal_neverallows.te
+++ b/public/hal_neverallows.te
@@ -23,6 +23,7 @@ neverallow {
   -hal_wifi_hostapd_server
   -hal_wifi_supplicant_server
   -hal_telephony_server
+  -hal_keymaster_server
 } domain:{ tcp_socket udp_socket rawip_socket } *;
 
 ###
-- 
2.27.0

