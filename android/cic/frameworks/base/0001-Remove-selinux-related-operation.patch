From 509bf67b3c74b954f29227d943d8b8cc2c270c66 Mon Sep 17 00:00:00 2001
From: "ji, zhenlong z" <zhenlong.z.ji@intel.com>
Date: Wed, 11 Mar 2020 13:45:10 +0800
Subject: [PATCH] remove selinux related operations

Change-Id: Ic4f231174ca22d044b6e3b6b2809ac073263bfc9
Signed-off-by: ji, zhenlong z <zhenlong.z.ji@intel.com>
---
 .../java/com/android/server/pm/PackageInstallerService.java  | 4 ----
 .../java/com/android/server/pm/PackageManagerService.java    | 5 -----
 2 files changed, 9 deletions(-)

diff --git a/services/core/java/com/android/server/pm/PackageInstallerService.java b/services/core/java/com/android/server/pm/PackageInstallerService.java
index 0b32d1a5d69..aa0a935538a 100644
--- a/services/core/java/com/android/server/pm/PackageInstallerService.java
+++ b/services/core/java/com/android/server/pm/PackageInstallerService.java
@@ -652,10 +652,6 @@ public class PackageInstallerService extends IPackageInstaller.Stub {
             // This purposefully throws if directory already exists
             throw new IOException("Failed to prepare session dir: " + stageDir, e);
         }
-
-        if (!SELinux.restorecon(stageDir)) {
-            throw new IOException("Failed to restorecon session dir: " + stageDir);
-        }
     }
 
     private String buildExternalStageCid(int sessionId) {
diff --git a/services/core/java/com/android/server/pm/PackageManagerService.java b/services/core/java/com/android/server/pm/PackageManagerService.java
index f1f3a140550..6e3dcbc9ea9 100644
--- a/services/core/java/com/android/server/pm/PackageManagerService.java
+++ b/services/core/java/com/android/server/pm/PackageManagerService.java
@@ -15919,11 +15919,6 @@ public class PackageManagerService extends IPackageManager.Stub
                 return false;
             }
 
-            if (!SELinux.restoreconRecursive(afterCodeFile)) {
-                Slog.w(TAG, "Failed to restorecon");
-                return false;
-            }
-
             // Reflect the rename internally
             codeFile = afterCodeFile;
             resourceFile = afterCodeFile;
-- 
2.20.1

