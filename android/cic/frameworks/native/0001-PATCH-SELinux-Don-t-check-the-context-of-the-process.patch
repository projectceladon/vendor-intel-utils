From 9e83be204fc7693f84d86b133172b8cffb107652 Mon Sep 17 00:00:00 2001
From: "ji, zhenlong z" <zhenlong.z.ji@intel.com>
Date: Wed, 11 Mar 2020 14:02:19 +0800
Subject: [PATCH] [PATCH] SELinux: Don't check the context of the process from
 host

Change-Id: Ifa3151cfb8ab6a6e7ae9a7e09866400e9470d7d2
Signed-off-by: ji, zhenlong z <zhenlong.z.ji@intel.com>
---
 cmds/servicemanager/service_manager.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/cmds/servicemanager/service_manager.c b/cmds/servicemanager/service_manager.c
index 6b340a8d3..1b6c6ff10 100644
--- a/cmds/servicemanager/service_manager.c
+++ b/cmds/servicemanager/service_manager.c
@@ -68,6 +68,11 @@ static bool check_mac_perms(pid_t spid, uid_t uid, const char *tctx, const char
     bool allowed;
     struct audit_data ad;
 
+    if (spid == 0) {
+        ALOGD("It seems the process checked is from outside container, pass it");
+        return true;
+    }
+
     if (getpidcon(spid, &sctx) < 0) {
         ALOGE("SELinux: getpidcon(pid=%d) failed to retrieve pid context.\n", spid);
         return false;
-- 
2.20.1

