From 30a6cf5589055fb4d48978e53bed833af9aa39f3 Mon Sep 17 00:00:00 2001
From: "ji, zhenlong z" <zhenlong.z.ji@intel.com>
Date: Fri, 8 May 2020 14:15:23 +0800
Subject: [PATCH] Grant the mount privilege for system users

Change-Id: Ice4fcedac98e23dbc965cc06fefce520cb2ff770
Signed-off-by: ji, zhenlong z <zhenlong.z.ji@intel.com>
---
 toys/lsb/mount.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/toys/lsb/mount.c b/toys/lsb/mount.c
index 0fd9dc52..10403f87 100644
--- a/toys/lsb/mount.c
+++ b/toys/lsb/mount.c
@@ -144,7 +144,7 @@ static void mount_filesystem(char *dev, char *dir, char *type,
 
   if (toys.optflags & FLAG_f) return;
 
-  if (getuid()) {
+  if (getuid() != 0 && getuid() != 1000) {
     if (TT.okuser) TT.okuser = 0;
     else {
       error_msg("'%s' not user mountable in fstab", dev);
@@ -308,7 +308,7 @@ void mount_main(void)
 
   // Do we need to do an /etc/fstab trawl?
   // This covers -a, -o remount, one argument, all user mounts
-  if ((toys.optflags & FLAG_a) || (dev && (!dir || getuid() || remount))) {
+  if ((toys.optflags & FLAG_a) || (dev && (!dir || (getuid() != 0 && getuid() != 1000) || remount))) {
     if (!remount) dlist_terminate(mtl = xgetmountlist("/etc/fstab"));
 
     for (mm = remount ? remount : mtl; mm; mm = (remount ? mm->prev : mm->next))
-- 
2.20.1

