From 4f803e4c29621241fc10396e02e455558c4e63ed Mon Sep 17 00:00:00 2001
From: Marc Mao <marc.mao@intel.com>
Date: Thu, 5 Sep 2019 15:39:42 +0800
Subject: [PATCH] Add layer task info support

Change-Id: I09d4b445faddb941ea807060ed1411b80168910f
Tracked-On:
Signed-off-by: Marc Mao <marc.mao@intel.com>
---
 include/hardware/hwcomposer2.h | 20 +++++++++++++++++++-
 1 file changed, 19 insertions(+), 1 deletion(-)

diff --git a/include/hardware/hwcomposer2.h b/include/hardware/hwcomposer2.h
index c9809ce8..2b1f9213 100644
--- a/include/hardware/hwcomposer2.h
+++ b/include/hardware/hwcomposer2.h
@@ -25,6 +25,8 @@
 
 __BEGIN_DECLS
 
+#define SUPPORT_LAYER_TASK_INFO  1
+
 /*
  * Enums
  *
@@ -270,7 +272,12 @@ typedef enum {
     HWC2_FUNCTION_GET_READBACK_BUFFER_FENCE,
     HWC2_FUNCTION_GET_RENDER_INTENTS,
     HWC2_FUNCTION_SET_COLOR_MODE_WITH_RENDER_INTENT,
-    HWC2_FUNCTION_GET_DATASPACE_SATURATION_MATRIX
+    HWC2_FUNCTION_GET_DATASPACE_SATURATION_MATRIX,
+
+    // Vendor extension
+#ifdef SUPPORT_LAYER_TASK_INFO
+     HWC2_FUNCTION_SET_LAYER_TASK_INFO = 0x100,
+#endif
 } hwc2_function_descriptor_t;
 
 /* Layer requests returned from getDisplayRequests */
@@ -524,6 +531,9 @@ static inline const char* getFunctionDescriptorName(
         case HWC2_FUNCTION_GET_RENDER_INTENTS: return "GetRenderIntents";
         case HWC2_FUNCTION_SET_COLOR_MODE_WITH_RENDER_INTENT: return "SetColorModeWithRenderIntent";
         case HWC2_FUNCTION_GET_DATASPACE_SATURATION_MATRIX: return "GetDataspaceSaturationMatrix";
+#ifdef SUPPORT_LAYER_TASK_INFO
+        case HWC2_FUNCTION_SET_LAYER_TASK_INFO: return "SetLayerTaskInfo";
+#endif
         default: return "Unknown";
     }
 }
@@ -722,6 +732,9 @@ enum class FunctionDescriptor : int32_t {
     GetRenderIntents = HWC2_FUNCTION_GET_RENDER_INTENTS,
     SetColorModeWithRenderIntent = HWC2_FUNCTION_SET_COLOR_MODE_WITH_RENDER_INTENT,
     GetDataspaceSaturationMatrix = HWC2_FUNCTION_GET_DATASPACE_SATURATION_MATRIX,
+#ifdef SUPPORT_LAYER_TASK_INFO
+    SetLayerTaskInfo = HWC2_FUNCTION_SET_LAYER_TASK_INFO,
+#endif
 };
 TO_STRING(hwc2_function_descriptor_t, FunctionDescriptor,
         getFunctionDescriptorName)
@@ -2326,6 +2339,11 @@ typedef int32_t /*hwc2_error_t*/ (*HWC2_PFN_SET_LAYER_Z_ORDER)(
         hwc2_device_t* device, hwc2_display_t display, hwc2_layer_t layer,
         uint32_t z);
 
+
+typedef int32_t /*hwc2_error_t*/ (*HWC2_PFN_SET_LAYER_TASK_INFO)(
+        hwc2_device_t* device, hwc2_display_t display, hwc2_layer_t layer,
+        uint32_t stackId, uint32_t taskId, uint32_t userId, uint32_t index);
+
 __END_DECLS
 
 #endif
-- 
2.17.1

