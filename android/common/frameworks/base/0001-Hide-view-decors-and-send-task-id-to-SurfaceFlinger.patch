From 46091300236aa410b619a13221ea810793eeb551 Mon Sep 17 00:00:00 2001
From: Marc Mao <marc.mao@intel.com>
Date: Sat, 12 Oct 2019 14:23:18 +0800
Subject: [PATCH] Hide view decors and send task id to SurfaceFlinger

Change-Id: I5ec170ca1029a390df01a69d0bfc57451b1c896e
Tracked-On:
Signed-off-by: Marc Mao <marc.mao@intel.com>
---
 core/java/com/android/internal/policy/DecorView.java      | 4 ++--
 .../com/android/internal/widget/DecorCaptionView.java     | 2 +-
 .../java/com/android/server/wm/WindowStateAnimator.java   | 8 +++++++-
 3 files changed, 10 insertions(+), 4 deletions(-)

diff --git a/core/java/com/android/internal/policy/DecorView.java b/core/java/com/android/internal/policy/DecorView.java
index 6ad1d72eaec..c04e75da022 100644
--- a/core/java/com/android/internal/policy/DecorView.java
+++ b/core/java/com/android/internal/policy/DecorView.java
@@ -117,9 +117,9 @@ public class DecorView extends FrameLayout implements RootViewSurfaceTaker, Wind
     private static final boolean SWEEP_OPEN_MENU = false;
 
     // The height of a window which has focus in DIP.
-    private final static int DECOR_SHADOW_FOCUSED_HEIGHT_IN_DIP = 20;
+    private final static int DECOR_SHADOW_FOCUSED_HEIGHT_IN_DIP = 0; //20;
     // The height of a window which has not in DIP.
-    private final static int DECOR_SHADOW_UNFOCUSED_HEIGHT_IN_DIP = 5;
+    private final static int DECOR_SHADOW_UNFOCUSED_HEIGHT_IN_DIP = 0; //5;
 
     public static final ColorViewAttributes STATUS_BAR_COLOR_VIEW_ATTRIBUTES =
             new ColorViewAttributes(SYSTEM_UI_FLAG_FULLSCREEN, FLAG_TRANSLUCENT_STATUS,
diff --git a/core/java/com/android/internal/widget/DecorCaptionView.java b/core/java/com/android/internal/widget/DecorCaptionView.java
index b4191136035..352e83c2727 100644
--- a/core/java/com/android/internal/widget/DecorCaptionView.java
+++ b/core/java/com/android/internal/widget/DecorCaptionView.java
@@ -334,7 +334,7 @@ public class DecorCaptionView extends ViewGroup implements View.OnTouchListener,
      **/
     private void updateCaptionVisibility() {
         // Don't show the caption if the window has e.g. entered full screen.
-        boolean invisible = isFillingScreen() || !mShow;
+        boolean invisible = true; // isFillingScreen() || !mShow;
         mCaption.setVisibility(invisible ? GONE : VISIBLE);
         mCaption.setOnTouchListener(this);
     }
diff --git a/services/core/java/com/android/server/wm/WindowStateAnimator.java b/services/core/java/com/android/server/wm/WindowStateAnimator.java
index 3eef12540e7..1a9bf1f732e 100644
--- a/services/core/java/com/android/server/wm/WindowStateAnimator.java
+++ b/services/core/java/com/android/server/wm/WindowStateAnimator.java
@@ -509,8 +509,14 @@ class WindowStateAnimator {
                 flags |= SurfaceControl.OPAQUE;
             }
 
+            StringBuilder name = new StringBuilder(attrs.getTitle().toString());
+            Task task = mWin.getTask();
+            if (task != null) {
+                name.append("-s" + task.mStack.mStackId + "-t" + task.mTaskId + "-u" + task.mUserId);
+            }
+
             mSurfaceController = new WindowSurfaceController(mSession.mSurfaceSession,
-                    attrs.getTitle().toString(), width, height, format, flags, this,
+                    name.toString(), width, height, format, flags, this,
                     windowType, ownerUid);
 
             setOffsetPositionForStackResize(false);
-- 
2.17.1

