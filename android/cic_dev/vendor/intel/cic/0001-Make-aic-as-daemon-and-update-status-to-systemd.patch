From eccdd17e9f6643cddc58629a8003788ea4160ef9 Mon Sep 17 00:00:00 2001
From: rnaidu <ramya.v.naidu@intel.com>
Date: Tue, 19 May 2020 09:07:02 +0530
Subject: [PATCH] Make-aic-as-daemon-and-update-status-to-systemd

Change-Id: Ic4ac81717637031c07b96d4bde4e7491155fc8cd
Tracked-On: OAM-90809
Signed-off-by: rnaidu <ramya.v.naidu@intel.com>
---
 host/docker/scripts/aic | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/host/docker/scripts/aic b/host/docker/scripts/aic
index e6577bf..0fb70cd 100755
--- a/host/docker/scripts/aic
+++ b/host/docker/scripts/aic
@@ -926,6 +926,21 @@ function start {
 	nsenter -t $ANDROID_PID -n ip link set $INTF name wlan0
     fi
 
+	sleep 3
+	while true :
+    do
+        BOOT1=$(docker exec android0 getprop sys.boot_completed)
+	if [[ ! -z $BOOT1 ]]; then
+            systemd-notify --status="ANDROID READY"
+            systemd-notify --ready
+            sleep 3
+	    continue
+	fi
+        systemd-notify --status="ANDROID NOT READY"
+        systemd-notify --ready
+        sleep 3
+    done
+
 }
 
 function stop {
@@ -980,6 +995,8 @@ function stop {
 
     # umount binderfs mount point if any
     umount_binderfs
+	systemd-notify --status="ANDROID STOPPED"
+    systemd-notify --ready
 
     # umount multi-user data partition if any
     MULTI_USER_DIR=$(echo -n $($DOCKER inspect -f '{{ range .Mounts }}{{ if eq .Destination "/data-multi-user" }}{{ .Source }}{{ end }} {{ end }}' aic-manager 2>/dev/null))
-- 
2.17.1

