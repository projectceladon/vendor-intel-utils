From e55e2264b43bfc019b9a074294ef0a3e9948e621 Mon Sep 17 00:00:00 2001
From: bxu10x <bingx.xu@intel.com>
Date: Mon, 28 Sep 2020 13:59:14 +0800
Subject: [PATCH] Disable power manager

Change-Id: I41781521f769e36d41fcfcb47b6f1f00c8d50af4
Tracked-On: ACP-1291
Signed-off-by: bxu10x <bingx.xu@intel.com>
---
 power.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/power.c b/power.c
index 10ba380..34b34ab 100644
--- a/power.c
+++ b/power.c
@@ -24,6 +24,8 @@
 #include <sys/stat.h>
 #include <sys/types.h>
 #include <pthread.h>
+#include <cutils/properties.h>
+
 
 #define LOG_TAG "power"
 #include <log/log.h>
@@ -84,6 +86,12 @@ initialize_fds(void)
 int
 acquire_wake_lock(int lock, const char* id)
 {
+    char prop[PATH_MAX] = {0};
+    property_get("enable.power", prop, NULL);
+    if (strcmp(prop,"true") != 0) {
+        ALOGE("acquire_wake_lock return lock=%d id='%s' prop='%s'\n", lock, id, prop);
+        return -EINVAL;
+    }
     initialize_fds();
 
 //    ALOGI("acquire_wake_lock lock=%d id='%s'\n", lock, id);
-- 
2.17.1

